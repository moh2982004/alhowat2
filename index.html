<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title> هواة الشمال </title>
    <link rel="apple-touch-icon" sizes="180x180" href="logo.png">
    <link rel="icon" type="image/png" sizes="32x32" href="logo.png">
    <link rel="icon" type="image/png" sizes="16x16" href="logo.png">

    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Cairo:wght@300;400;600;700&display=swap" rel="stylesheet">
    <style>
        /* جميع أنماط CSS الأصلية كما هي */
        :root {
            --accent: #0b5d3b;
            --muted: #6b6b6b;
            --bg: #ffffff;
            --card: #fbfbfb;
            --border: #e6e6e6;
            --maxwidth: 1200px;
            --container-padding: 18px;
        }

        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        html, body {
            height: 100%;
            font-family: 'Cairo', sans-serif;
            background: linear-gradient(180deg, #fff, #f7f7f7);
            color: #222;
            -webkit-font-smoothing: antialiased;
            -moz-osx-font-smoothing: grayscale;
        }

        .wrap {
            max-width: var(--maxwidth);
            margin: 0 auto;
            padding: 0 var(--container-padding);
        }

        /* الشريط العلوي */
        .top-bar {
            background: var(--accent);
            color: white;
            padding: 10px 0;
            font-size: 14px;
        }

        .top-bar .wrap {
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .datetime-container {
            display: flex;
            flex-direction: column;
            align-items: flex-end;
        }

        .datetime-arabic {
            font-family: 'Cairo', sans-serif;
            direction: rtl;
        }

        .datetime-french {
            font-family: Arial, sans-serif;
            direction: ltr;
            font-size: 13px;
            margin-top: 2px;
            opacity: 0.9;
        }

        /* العنوان الرئيسي */
        header.site-header {
            display: flex;
            align-items: center;
            justify-content: space-between;
            gap: 20px;
            padding: 20px 0;
            border-bottom: 1px solid var(--border);
        }

        .brand {
            display: flex;
            align-items: center;
            gap: 15px;
        }

        .logo {
            width: 90px;
            height: 90px;
            background: var(--card);
            border-radius: 8px;
            display: flex;
            align-items: center;
            justify-content: center;
            border: 1px solid var(--border);
            font-weight: bold;
            color: var(--accent);
            text-align: center;
            line-height: 1.2;
            overflow: hidden;
        }

        .logo img {
            width: 100%;
            height: 100%;
            object-fit: cover;
        }

        .brand-text h1 {
            margin: 0;
            font-size: 24px;
            font-weight: 700;
        }

        .brand-text .subtitle {
            color: var(--muted);
            font-size: 16px;
            margin-top: 5px;
        }

        /* وصف الموقع */
        .site-description {
            background: linear-gradient(180deg, rgba(11, 93, 59, 0.05), transparent);
            padding: 15px 0;
            text-align: center;
            font-size: 16px;
            color: var(--muted);
            margin: 10px 0;
        }

        /* التخطيط الرئيسي الجديد */
        .main-content-grid {
            display: grid;
            grid-template-columns: 1fr 2fr 1fr;
            gap: 20px;
            align-items: start;
            margin: 25px 0;
        }

        .left-column {
            grid-column: 1;
        }

        .center-column {
            grid-column: 2;
            display: flex;
            flex-direction: column;
            gap: 20px;
        }

        .right-column {
            grid-column: 3;
        }

        @media (max-width: 900px) {
            .main-content-grid {
                grid-template-columns: 1fr;
            }
            
            .left-column,
            .center-column,
            .right-column {
                grid-column: 1;
            }
        }

        /* الأقسام */
        .section {
            background: var(--card);
            padding: 20px;
            border-radius: 10px;
            border: 1px solid var(--border);
            box-shadow: 0 4px 12px rgba(20, 20, 20, 0.03);
            margin-bottom: 20px;
        }

        .section h2 {
            margin-bottom: 15px;
            color: var(--accent);
            font-size: 18px;
            border-bottom: 1px solid var(--border);
            padding-bottom: 8px;
        }

        /* اللقاءات في الجانب الأيسر */
        .match {
            padding: 12px 0;
            border-bottom: 1px dashed rgba(0, 0, 0, 0.1);
            display: flex;
            flex-direction: column;
            align-items: center;
            cursor: pointer;
            transition: background-color 0.2s;
        }

        .match:hover {
            background-color: rgba(11, 93, 59, 0.05);
        }

        .match:last-child {
            border-bottom: none;
        }

        .match .teams {
            display: flex;
            justify-content: space-between;
            margin-bottom: 8px;
            align-items: center;
            width: 100%;
        }

        .match .team {
            flex: 1;
            text-align: center;
            font-size: 12px;
            font-weight: 600;
        }

        .match-result {
            font-weight: bold;
            color: var(--accent);
            font-size: 14px;
            margin: 0 10px;
            min-width: 50px;
            text-align: center;
        }

        /* التاريخ والساعة في سطر واحد (الجانب الأيسر) */
        .match-time-date {
            color: var(--muted);
            font-size: 11px;
            text-align: center;
            margin-top: 3px;
            display: flex;
            justify-content: center;
            align-items: center;
            gap: 10px;
            width: 100%;
        }

        /* الملعب في سطر منفصل (الجانب الأيسر) */
        .match .stadium {
            color: var(--muted);
            font-size: 11px;
            text-align: center;
            margin-top: 3px;
            width: 100%;
        }

        /* التواصل */
        .contact-info {
            line-height: 1.8;
        }

        .contact-info p {
            margin-bottom: 10px;
        }

        /* الإعلانات */
        .ad-space {
            background: #f0f0f0;
            border: 1px solid var(--border);
            border-radius: 8px;
            height: 250px;
            display: flex;
            align-items: center;
            justify-content: center;
            margin-bottom: 20px;
            color: var(--muted);
            overflow: hidden;
            position: relative;
            cursor: pointer;
            transition: all 0.3s;
        }

        .ad-space a {
            width: 100%;
            height: 100%;
            display: flex;
            align-items: center;
            justify-content: center;
            text-decoration: none;
            position: relative;
        }

        .ad-space img {
            max-width: 100%;
            max-height: 100%;
            object-fit: contain;
            padding: 10px;
            transition: transform 0.3s;
        }

        .ad-space:hover {
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(0,0,0,0.1);
        }

        .ad-space:hover img {
            transform: scale(1.02);
        }

        .ad-space .ad-title {
            position: absolute;
            bottom: 0;
            left: 0;
            right: 0;
            background: rgba(0,0,0,0.7);
            color: white;
            padding: 5px 10px;
            font-size: 12px;
            text-align: center;
            opacity: 0;
            transition: opacity 0.3s;
        }

        .ad-space:hover .ad-title {
            opacity: 1;
        }

        /* التذييل */
        footer {
            margin-top: 40px;
            padding: 20px 0;
            color: var(--muted);
            font-size: 14px;
            border-top: 1px solid var(--border);
            text-align: center;
        }

        /* صفحات متعددة */
        .page-content {
            display: none;
        }

        .page-content.active {
            display: block;
        }

        /* أنماط إضافية للمباريات */
        .matches-nav {
            display: flex;
            gap: 5px;
            margin-bottom: 0;
            border-bottom: 1px solid var(--border);
            padding-bottom: 0;
        }

        .matches-nav-btn {
            background: #f5f5f5;
            color: var(--muted);
            border: 1px solid var(--border);
            border-bottom: none;
            padding: 12px 20px;
            border-radius: 8px 8px 0 0;
            cursor: pointer;
            font-size: 14px;
            font-weight: 600;
            transition: all 0.3s;
            position: relative;
            bottom: -1px;
        }

        .matches-nav-btn:hover {
            background: #e9e9e9;
        }

        .matches-nav-btn.active {
            background: white;
            color: var(--accent);
            border-bottom: 1px solid white;
            box-shadow: 0 2px 3px rgba(0,0,0,0.05);
        }
        
        .matches-tab {
            display: none;
        }
        
        .matches-tab.active {
            display: block;
        }
        
        .matches-container {
            background: white;
            border: 1px solid var(--border);
            border-top: none;
            border-radius: 0 0 8px 8px;
            min-height: 300px;
            max-height: 500px;
            overflow-y: auto;
            padding: 15px;
            position: relative;
        }

        /* شارات المجموعة والدورة */
        .match-badge {
            background: #e63946;
            color: white;
            padding: 2px 6px;
            border-radius: 10px;
            font-size: 11px;
            margin-left: 5px;
            font-weight: bold;
        }

        .round-badge {
            background: #0b5d3b;
            color: white;
            padding: 2px 6px;
            border-radius: 10px;
            font-size: 9px;
            margin-left: 3px;
            font-weight: bold;
        }

        .badges-container {
            display: flex;
            justify-content: center;
            gap: 5px;
            margin-bottom: 8px;
            width: 100%;
        }

        .today-matches-loading {
            text-align: center;
            padding: 15px;
            color: var(--muted);
            font-size: 9px;
        }

        .today-matches-empty {
            text-align: center;
            padding: 15px;
            color: var(--muted);
            font-size:9px;
            font-style: italic;
        }

        .refresh-today-btn {
            background: var(--accent);
            color: white;
            border: none;
            padding: 6px 12px;
            border-radius: 4px;
            cursor: pointer;
            font-size: 9px;
            margin: 8px auto 0;
            display: block;
            transition: background 0.3s;
        }

        .refresh-today-btn:hover {
            background: #09482c;
        }

        /* شريط التمرير المخصص */
        .matches-container::-webkit-scrollbar {
            width: 8px;
        }

        .matches-container::-webkit-scrollbar-track {
            background: #f1f1f1;
            border-radius: 4px;
        }

        .matches-container::-webkit-scrollbar-thumb {
            background: var(--accent);
            border-radius: 4px;
        }

        .matches-container::-webkit-scrollbar-thumb:hover {
            background: #09482c;
        }

        /* أنماط جديدة للعرض الديناميكي */
        .divisions-container {
            display: flex;
            flex-direction: column;
            gap: 15px;
        }

        .division-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 10px 15px;
            background: rgba(11, 93, 59, 0.05);
            border-radius: 8px;
            cursor: pointer;
            transition: background 0.3s;
        }

        .division-header:hover {
            background: rgba(11, 93, 59, 0.1);
        }

        .division-header h3 {
            margin: 0;
            color: var(--accent);
            font-size: 18px;
        }

        .division-arrow {
            transition: transform 0.3s;
        }

        .division-header.active .division-arrow {
            transform: rotate(180deg);
        }

        .groups-container {
            display: none;
            grid-template-columns: repeat(auto-fill, minmax(150px, 1fr));
            gap: 15px;
            margin-top: 15px;
            padding: 0 10px;
        }

        .division-header.active + .groups-container {
            display: grid;
        }

        .group-card {
            background: white;
            border: 1px solid var(--border);
            border-radius: 8px;
            padding: 15px;
            text-align: center;
            cursor: pointer;
            transition: all 0.3s;
        }

        .group-card:hover {
            transform: translateY(-3px);
            box-shadow: 0 5px 15px rgba(0,0,0,0.1);
            border-color: var(--accent);
        }

        .group-card h4 {
            margin: 0 0 10px 0;
            color: var(--accent);
            font-size: 16px;
        }

        .group-card p {
            margin: 0;
            color: var(--muted);
            font-size: 13px;
        }

        .group-info {
            display: none;
            padding: 20px;
            background: white;
            border-radius: 8px;
            border: 1px solid var(--border);
            margin-top: 20px;
        }

        .group-info.active {
            display: block;
        }

        .back-button {
            background: var(--accent);
            color: white;
            border: none;
            padding: 8px 15px;
            border-radius: 4px;
            cursor: pointer;
            font-size: 14px;
            margin-bottom: 15px;
            transition: background 0.3s;
        }

        .back-button:hover {
            background: #09482c;
        }

        .group-tabs {
            display: flex;
            gap: 5px;
            margin-bottom: 15px;
            border-bottom: 1px solid var(--border);
            flex-wrap: wrap;
        }

        .group-tab {
            background: #f5f5f5;
            color: var(--muted);
            border: 1px solid var(--border);
            border-bottom: none;
            padding: 10px 15px;
            border-radius: 6px 6px 0 0;
            cursor: pointer;
            font-size: 14px;
            transition: all 0.3s;
        }

        .group-tab:hover {
            background: #e9e9e9;
        }

        .group-tab.active {
            background: white;
            color: var(--accent);
            border-bottom: 1px solid white;
        }

        .group-tab-content {
            display: none;
        }

        .group-tab-content.active {
            display: block;
        }

        .loading-data {
            text-align: center;
            padding: 20px;
            color: var(--muted);
        }

        .promotion {
            background: rgba(46, 204, 113, 0.1);
        }

        .relegation {
            background: rgba(231, 76, 60, 0.1);
        }

        /* أنماط المربعات للدورات */
        .round-box {
            background: white;
            border: 1px solid var(--border);
            border-radius: 10px;
            margin-bottom: 20px;
            overflow: hidden;
            box-shadow: 0 3px 10px rgba(0,0,0,0.08);
        }
        
        .round-header {
            background: linear-gradient(135deg, var(--accent), #0a4a2f);
            color: white;
            padding: 12px 20px;
            font-size: 16px;
            font-weight: 700;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }
        
        .round-matches {
            padding: 15px;
        }
        
        .round-match {
            background: #f8f9fa;
            margin: 8px 0;
            padding: 12px 15px;
            border-radius: 8px;
            border: 1px solid #dee2e6;
            display: flex;
            flex-direction: column;
            align-items: center;
            cursor: pointer;
            transition: background-color 0.2s;
        }
        
        .round-match:hover {
            background-color: rgba(11, 93, 59, 0.05);
        }
        
        .round-match-teams {
            flex: 1;
            display: flex;
            justify-content: space-between;
            align-items: center;
            width: 100%;
            margin-bottom: 5px;
        }
        
        .round-match-result {
            font-weight: bold;
            font-size: 14px;
            color: var(--accent);
            background: white;
            padding: 6px 12px;
            border-radius: 6px;
            border: 1px solid var(--accent);
            min-width: 70px;
            text-align: center;
        }
        
        /* التاريخ والساعة والملعب في سطر واحد (في الأقسام والمجموعات) */
        .round-match-details {
            font-size: 12px;
            color: var(--muted);
            text-align: center;
            margin-top: 5px;
            width: 100%;
            display: flex;
            justify-content: center;
            align-items: center;
            gap: 15px;
        }
        
        .program-round-box {
            background: white;
            border: 1px solid var(--border);
            border-radius: 10px;
            margin-bottom: 20px;
            overflow: hidden;
        }
        
        .program-round-header {
            background: linear-gradient(135deg, #2c3e50, #3498db);
            color: white;
            padding: 12px 20px;
            font-size: 16px;
            font-weight: 700;
        }
        
        .program-match {
            background: #f8f9fa;
            margin: 8px;
            padding: 12px;
            border-radius: 8px;
            border: 1px solid #dee2e6;
            cursor: pointer;
            transition: background-color 0.2s;
        }
        
        .program-match:hover {
            background-color: rgba(11, 93, 59, 0.05);
        }
        
        .resting-teams {
            background: #e8f4f8;
            margin: 8px;
            padding: 10px;
            border-radius: 6px;
            border: 1px solid #b8daff;
            color: #004085;
            font-style: italic;
            text-align: center;
        }
        
        /* ========== تحسينات جديدة لجدول الترتيب - جميع الشاشات ========== */
        .standings-container {
            margin-top: 15px;
            overflow-x: auto;
            -webkit-overflow-scrolling: touch;
        }
        
        .standings-table {
            width: 100%;
            border-collapse: collapse;
            margin-top: 10px;
            font-size: 12px;
            min-width: 750px; /* عرض مناسب لجميع الأعمدة */
        }
        
        /* تثبيت عرض الأعمدة بحيث تأخذ المساحة المناسبة فقط */
        .standings-table th,
        .standings-table td {
            text-align: center;
            white-space: nowrap;
            padding: 6px 4px;
            border-bottom: 1px solid var(--border);
        }
        
        .standings-table th {
            background: rgba(11, 93, 59, 0.1);
            color: var(--accent);
            font-weight: 600;
            border-bottom: 2px solid var(--accent);
        }
        
        /* تحديد عرض ثابت ومضبوط لكل عمود */
        .standings-table th:nth-child(1), /* # */
        .standings-table td:nth-child(1) {
            width: 10px;
            min-width: 10px;
            max-width: 20px;
        }
        
       .standings-table th:nth-child(2),/* الفريق */
        .standings-table td:nth-child(2) {
            width: 30px;
            min-width: 30px;
            max-width:60px;
            text-align: right;
            padding-right: 20px;
        }
        
        .standings-table th:nth-child(3), /* ل */
        .standings-table td:nth-child(3),
        .standings-table th:nth-child(4), /* ف */
        .standings-table td:nth-child(4),
        .standings-table th:nth-child(5), /* ت */
        .standings-table td:nth-child(5),
        .standings-table th:nth-child(6), /* خ */
        .standings-table td:nth-child(6) {
            width: 35px;
            min-width: 35px;
            max-width: 35px;
        }
        
        .standings-table th:nth-child(7), /* له */
        .standings-table td:nth-child(7),
        .standings-table th:nth-child(8), /* ع */
        .standings-table td:nth-child(8) {
            width: 40px;
            min-width: 40px;
            max-width: 40px;
        }
        
        /* عمود فارق الأهداف يأخذ المساحة المناسبة للكتابة فقط */
        .standings-table th:nth-child(9), /* ± */
        .standings-table td:nth-child(9) {
            width: 45px;
            min-width: 45px;
            max-width: 45px;
        }
        
        .standings-table th:nth-child(10), /* نقاط */
        .standings-table td:nth-child(10) {
            width: 50px;
            min-width: 50px;
            max-width: 50px;
        }
        
        .standings-table th:nth-child(11), /* انس */
        .standings-table td:nth-child(11),
        .standings-table th:nth-child(12), /* عقوبات */
        .standings-table td:nth-child(12) {
            width: 45px;
            min-width: 45px;
            max-width: 45px;
        }
        
        .standings-table tr:hover {
            background: rgba(11, 93, 59, 0.05);
        }
        
        .team-name-cell {
            text-align: right !important;
            font-weight: 500;
            overflow: hidden;
            text-overflow: ellipsis;
        }
        
        .position-cell {
            font-weight: bold;
            color: var(--accent);
        }
        
        .points-cell {
            font-weight: bold;
            color: #e63946;
            background: rgba(230, 57, 70, 0.1);
            border-radius: 4px;
        }

        /* أنماط لنتائج آخر دورة */
        .last-round-matches {
            display: flex;
            flex-direction: column;
            gap: 10px;
        }

        .last-round-match {
            background: #f8f9fa;
            padding: 12px;
            border-radius: 8px;
            border: 1px solid #dee2e6;
            display: flex;
            flex-direction: column;
            gap: 5px;
            cursor: pointer;
            transition: background-color 0.2s;
        }

        .last-round-match:hover {
            background-color: rgba(11, 93, 59, 0.05);
        }

        .last-round-teams {
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .last-round-result {
            font-weight: bold;
            color: var(--accent);
            font-size: 14px;
            background: white;
            padding: 4px 10px;
            border-radius: 6px;
            border: 1px solid var(--accent);
        }

        .last-round-details {
            display: flex;
            justify-content: space-between;
            color: var(--muted);
            font-size: 12px;
        }

        /* عرض المباريات السابقة والقادمة في المجموعة */
        .group-matches-grid {
            display: flex;
            flex-direction: column;
            gap: 10px;
            max-height: 300px;
            overflow-y: auto;
            padding-right: 5px;
        }

        .group-match-item {
            background: #f8f9fa;
            padding: 10px;
            border-radius: 6px;
            border-left: 3px solid var(--accent);
            cursor: pointer;
            transition: background-color 0.2s;
        }

        .group-match-item:hover {
            background-color: rgba(11, 93, 59, 0.05);
        }

        .group-match-teams {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 5px;
        }

        .group-match-date {
            color: var(--muted);
            font-size: 11px;
            text-align: center;
        }

        /* تحسينات للجدول */
        .standings-improved {
            overflow-x: auto;
        }

        /* أنماط لبرنامج الدورات */
        .program-rounds-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(280px, 1fr));
            gap: 15px;
        }

        .program-round-item {
            background: white;
            border: 1px solid var(--border);
            border-radius: 8px;
            overflow: hidden;
            box-shadow: 0 3px 8px rgba(0,0,0,0.05);
        }

        .program-round-header {
            background: linear-gradient(135deg, #3498db, #2980b9);
            color: white;
            padding: 10px 15px;
            font-size: 14px;
            font-weight: 700;
        }

        .program-round-matches {
            padding: 10px;
        }

        .program-round-match {
            background: #f8f9fa;
            margin: 5px 0;
            padding: 8px 10px;
            border-radius: 5px;
            border: 1px solid #dee2e6;
            font-size: 12px;
            cursor: pointer;
            transition: background-color 0.2s;
        }

        .program-round-match:hover {
            background-color: rgba(11, 93, 59, 0.05);
        }

        .program-match-teams {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 3px;
        }

        .program-match-time {
            color: var(--muted);
            font-size: 11px;
            text-align: center;
        }

        /* نافذة تفاصيل المباراة */
        .match-details-overlay {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.85);
            display: none;
            justify-content: center;
            align-items: center;
            z-index: 2000;
            padding: 20px;
        }

        .match-details-overlay.active {
            display: flex;
        }

        .match-details-container {
            background: white;
            border-radius: 15px;
            width: 100%;
            max-width: 700px;
            max-height: 90vh;
            overflow: hidden;
            display: flex;
            flex-direction: column;
            box-shadow: 0 20px 50px rgba(0,0,0,0.3);
        }

        .match-details-header {
            color: white;
            padding: 20px 30px;
            display: flex;
            justify-content: space-between;
            align-items: center;
            position: relative;
        }

        .match-details-header h2 {
            margin: 0;
            font-size: 20px;
            font-weight: 700;
            color: white;
            z-index: 2;
        }

        .close-match-details {
            background: rgba(255,255,255,0.2);
            border: none;
            color: white;
            width: 40px;
            height: 40px;
            border-radius: 50%;
            font-size: 22px;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            transition: all 0.3s;
            z-index: 2;
        }

        .close-match-details:hover {
            background: rgba(255,255,255,0.3);
            transform: rotate(90deg);
        }

        .match-details-content {
            padding: 25px;
            overflow-y: auto;
            flex: 1;
        }

        .match-info-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(300px, 1fr));
            gap: 20px;
            margin-bottom: 25px;
        }

        .match-info-section {
            background: #f8f9fa;
            padding: 15px;
            border-radius: 8px;
            border: 1px solid var(--border);
        }

        .match-info-section h3 {
            color: var(--accent);
            margin-bottom: 10px;
            padding-bottom: 8px;
            border-bottom: 1px solid var(--border);
        }

        .match-info-item {
            display: flex;
            justify-content: space-between;
            margin-bottom: 8px;
            padding-bottom: 5px;
            border-bottom: 1px dashed #ddd;
        }

        .match-info-label {
            font-weight: 600;
            color: var(--accent);
        }

        .match-info-value {
            color: #333;
            text-align: left;
        }

        /* أنماط محسنة لعرض النتيجة في تفاصيل المباراة */
        .match-score-display {
            background: linear-gradient(135deg, rgba(11, 93, 59, 0.3), rgba(46, 204, 113, 0.3));
            padding: 25px;
            border-radius: 15px;
            margin: 20px 0;
            border: 3px solid rgba(255,255,255,0.4);
            backdrop-filter: blur(10px);
        }

        .match-score-teams {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 15px;
        }

        .match-score-team {
            text-align: center;
            flex: 1;
        }

        .match-score-team-name {
            font-size: 22px;
            font-weight: bold;
            color: white;
            margin-bottom: 15px;
            text-shadow: 2px 2px 4px rgba(0,0,0,0.5);
        }

        .match-score-goals {
            font-size: 48px;
            font-weight: bold;
            color: #ffd166;
            background: rgba(0,0,0,0.5);
            padding: 15px 30px;
            border-radius: 12px;
            display: inline-block;
            min-width: 100px;
            box-shadow: 0 8px 25px rgba(0,0,0,0.3);
            border: 2px solid rgba(255, 209, 102, 0.5);
        }

        .match-score-vs {
            font-size: 28px;
            color: white;
            margin: 0 25px;
            text-shadow: 2px 2px 4px rgba(0,0,0,0.5);
            font-weight: bold;
        }

        .match-result-status {
            text-align: center;
            color: white;
            font-size: 18px;
            margin-top: 20px;
            padding: 12px;
            border-radius: 8px;
            background: rgba(0,0,0,0.3);
            border: 1px solid rgba(255,255,255,0.2);
        }

        .match-notes {
            background: #fff8e1;
            border: 1px solid #ffd54f;
            border-radius: 8px;
            padding: 15px;
            margin-top: 20px;
        }

        .match-notes h4 {
            color: #e65100;
            margin-bottom: 10px;
        }

        /* ========== قسم الأخبار المعدل ========== */
        .news-main-section {
            margin-bottom: 0;
            border: 1px solid var(--border);
            border-radius: 12px;
            overflow: hidden;
            box-shadow: 0 5px 20px rgba(0,0,0,0.08);
            background: white;
        }

        .news-main-header {
            background: linear-gradient(135deg, var(--accent), #0a4a2f);
            color: white;
            padding: 18px 25px;
            display: flex;
            justify-content: space-between;
            align-items: center;
            position: relative;
        }

        .news-main-header h2 {
            margin: 0;
            font-size: 22px;
            font-weight: 700;
        }

        .news-main-header::after {
            content: "";
            position: absolute;
            bottom: 0;
            left: 0;
            width: 100%;
            height: 4px;
            background: linear-gradient(90deg, #ffd166, #ef476f, #118ab2);
        }

        .news-main-slider {
            position: relative;
            min-height: 400px;
            overflow: hidden;
        }

        .news-slide {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            opacity: 0;
            transform: translateX(100%);
            transition: opacity 0.6s ease, transform 0.6s ease;
            display: flex;
            flex-direction: column;
            padding: 0;
        }

        .news-slide.active {
            opacity: 1;
            transform: translateX(0);
        }

        .news-slide-content {
            padding: 25px;
            flex: 1;
            display: flex;
            flex-direction: column;
        }

        /* حاوية الصورة في الشريحة الرئيسية */
        .news-image-container {
            width: 100%;
            height: 200px;
            overflow: hidden;
            border-radius: 10px;
            margin-bottom: 20px;
            display: flex;
            align-items: center;
            justify-content: center;
            background-color: #f8f9fa;
            position: relative;
        }

        .news-image-container img {
            max-width: 100%;
            max-height: 100%;
            width: auto;
            height: auto;
            object-fit: contain;
            display: block;
        }

        .news-image-container:hover img {
            transform: scale(1.02);
        }

        .news-title {
            font-size: 18px;
            font-weight: 700;
            color: var(--accent);
            margin-bottom: 15px;
            line-height: 1.4;
            cursor: pointer;
            transition: color 0.3s;
        }

        .news-title:hover {
            color: #0a4a2f;
            text-decoration: underline;
        }

        .news-excerpt {
            color: #555;
            line-height: 1.7;
            margin-bottom: 20px;
            flex: 1;
            font-size: 14px;
        }

        .news-meta {
            display: flex;
            justify-content: space-between;
            color: var(--muted);
            font-size: 12px;
            padding-top: 15px;
            border-top: 1px solid var(--border);
        }

        .news-date {
            display: flex;
            align-items: center;
            gap: 5px;
        }

        .news-read-more {
            color: var(--accent);
            font-weight: 600;
            cursor: pointer;
            transition: color 0.3s;
        }

        .news-read-more:hover {
            color: #0a4a2f;
            text-decoration: underline;
        }

        .news-slider-controls {
            display: flex;
            justify-content: center;
            align-items: center;
            gap: 15px;
            padding: 15px;
            background: #f9f9f9;
            border-top: 1px solid var(--border);
        }

        .news-slider-nav {
            display: flex;
            gap: 10px;
            align-items: center;
        }

        .news-slider-btn {
            width: 40px;
            height: 40px;
            border-radius: 50%;
            background: white;
            border: 2px solid var(--accent);
            color: var(--accent);
            display: flex;
            align-items: center;
            justify-content: center;
            cursor: pointer;
            font-size: 16px;
            transition: all 0.3s;
        }

        .news-slider-btn:hover {
            background: var(--accent);
            color: white;
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(11, 93, 59, 0.2);
        }

        .news-slider-dots {
            display: flex;
            gap: 8px;
        }

        .news-slider-dot {
            width: 10px;
            height: 10px;
            border-radius: 50%;
            background: #ddd;
            cursor: pointer;
            transition: all 0.3s;
        }

        .news-slider-dot.active {
            background: var(--accent);
            transform: scale(1.2);
        }

        .news-slider-dot:hover {
            background: #aaa;
        }

        .news-autoplay-control {
            display: flex;
            align-items: center;
            gap: 8px;
            color: var(--muted);
            font-size: 12px;
        }

        .autoplay-toggle {
            width: 45px;
            height: 24px;
            background: #ddd;
            border-radius: 12px;
            position: relative;
            cursor: pointer;
            transition: background 0.3s;
        }

        .autoplay-toggle.active {
            background: var(--accent);
        }

        .autoplay-toggle::after {
            content: "";
            position: absolute;
            top: 2px;
            left: 2px;
            width: 20px;
            height: 20px;
            background: white;
            border-radius: 50%;
            transition: transform 0.3s;
        }

        .autoplay-toggle.active::after {
            transform: translateX(21px);
        }

        /* نافذة المقال الكامل */
        .article-overlay {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.85);
            display: none;
            justify-content: center;
            align-items: center;
            z-index: 2000;
            padding: 20px;
        }

        .article-overlay.active {
            display: flex;
        }

        .article-container {
            background: white;
            border-radius: 15px;
            width: 100%;
            max-width: 900px;
            max-height: 90vh;
            overflow: hidden;
            display: flex;
            flex-direction: column;
            box-shadow: 0 20px 50px rgba(0,0,0,0.3);
        }

        .article-header {
            background: linear-gradient(135deg, var(--accent), #0a4a2f);
            color: white;
            padding: 20px 30px;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .article-header h2 {
            margin: 0;
            font-size: 24px;
            font-weight: 700;
        }

        .close-article {
            background: rgba(255,255,255,0.2);
            border: none;
            color: white;
            width: 40px;
            height: 40px;
            border-radius: 50%;
            font-size: 22px;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            transition: all 0.3s;
        }

        .close-article:hover {
            background: rgba(255,255,255,0.3);
            transform: rotate(90deg);
        }

        .article-content {
            padding: 30px;
            overflow-y: auto;
            flex: 1;
        }

        .article-meta {
            display: flex;
            justify-content: space-between;
            color: var(--muted);
            margin-bottom: 25px;
            padding-bottom: 15px;
            border-bottom: 1px solid var(--border);
        }

        .article-full-text {
            line-height: 1.8;
            font-size: 17px;
            color: #333;
        }

        .article-full-text p {
            margin-bottom: 20px;
        }

        .article-full-text h3 {
            color: var(--accent);
            margin: 25px 0 15px;
        }

        /* شارة الخبر المميز */
        .featured-badge {
            background: #ffd700;
            color: #333;
            padding: 2px 8px;
            border-radius: 10px;
            font-size: 11px;
            font-weight: bold;
            margin-right: 5px;
        }

        /* حاوية الصورة في المقال الكامل */
        .article-image-container {
            width: 100%;
            height: 300px;
            overflow: hidden;
            border-radius: 10px;
            margin-bottom: 25px;
            display: flex;
            align-items: center;
            justify-content: center;
            background-color: #f8f9fa;
            position: relative;
        }

        .article-image-container img {
            max-width: 100%;
            max-height: 100%;
            width: auto;
            height: auto;
            display: block;
            object-fit: contain;
        }

        /* مؤشر التمرير للهواتف */
        .scroll-indicator {
            position: absolute;
            right: 10px;
            top: 50%;
            transform: translateY(-50%);
            background: rgba(11, 93, 59, 0.7);
            color: white;
            padding: 5px 8px;
            border-radius: 15px;
            font-size: 10px;
            opacity: 0;
            transition: opacity 0.3s;
            pointer-events: none;
            z-index: 10;
        }

        .matches-container:hover .scroll-indicator {
            opacity: 1;
        }

        /* ========== أنماط جديدة للمباريات السابقة على شكل مربعات ========== */
        .previous-rounds-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(300px, 1fr));
            gap: 20px;
            margin-top: 15px;
        }

        .previous-round-box {
            background: white;
            border: 1px solid var(--border);
            border-radius: 10px;
            overflow: hidden;
            box-shadow: 0 4px 12px rgba(0,0,0,0.05);
            transition: transform 0.3s, box-shadow 0.3s;
        }

        .previous-round-box:hover {
            transform: translateY(-5px);
            box-shadow: 0 8px 25px rgba(0,0,0,0.1);
        }

        .previous-round-header {
            background: linear-gradient(135deg, #2c3e50, #34495e);
            color: white;
            padding: 15px 20px;
            font-size: 16px;
            font-weight: 700;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .previous-round-header .round-number {
            background: rgba(255,255,255,0.2);
            padding: 3px 10px;
            border-radius: 12px;
            font-size: 14px;
        }

        .previous-round-matches {
            padding: 15px;
        }

        .previous-round-match {
            background: #f8f9fa;
            margin: 8px 0;
            padding: 12px;
            border-radius: 8px;
            border: 1px solid #e9ecef;
            cursor: pointer;
            transition: all 0.3s;
        }

        .previous-round-match.confirmed-match {
            background: rgba(46, 204, 113, 0.1) !important;
            border-color: rgba(46, 204, 113, 0.3);
        }

        .previous-round-match:hover {
            transform: translateX(-5px);
            background: #e9ecef;
        }

        .previous-round-match.confirmed-match:hover {
            background: rgba(46, 204, 113, 0.2) !important;
        }

        .previous-match-teams {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 8px;
        }

        .previous-match-result {
            font-weight: bold;
            font-size: 14px;
            padding: 4px 10px;
            border-radius: 6px;
            text-align: center;
            min-width: 70px;
        }

        .previous-match-details {
            display: flex;
            justify-content: space-between;
            font-size: 11px;
            color: var(--muted);
        }

        .previous-match-date {
            display: flex;
            align-items: center;
            gap: 5px;
        }

        /* أنماط البادجات الجديدة فقط (بدون تغيير خلفيات المباريات) */
        .status-badge {
            padding: 2px 8px;
            border-radius: 10px;
            font-size: 10px;
            font-weight: 600;
        }

        .status-upcoming-badge {
            background: linear-gradient(135deg, #3498db, #2980b9);
            color: white;
        }

        .status-live-badge {
            background: linear-gradient(135deg, #e74c3c, #c0392b);
            color: white;
            animation: pulse 2s infinite;
        }

        .status-live-no-results-badge {
            background: linear-gradient(135deg, #e67e22, #d35400);
            color: white;
            animation: pulse 2s infinite;
        }

        .status-completed-confirmed-badge {
            background: linear-gradient(135deg, #27ae60, #229954);
            color: white;
        }

        .status-completed-unconfirmed-badge {
            background: linear-gradient(135deg, #3498db, #2980b9);
            color: white;
        }

        .status-past-no-results-badge {
            background: linear-gradient(135deg, #95a5a6, #7f8c8d);
            color: white;
        }

        .status-postponed-badge {
            background: linear-gradient(135deg, #f39c12, #e67e22);
            color: white;
        }

        .status-withdrawal-team1-badge, .status-withdrawal-team2-badge {
            background: linear-gradient(135deg, #8e44ad, #732d91);
            color: white;
        }

        .status-stopped-badge {
            background: linear-gradient(135deg, #2c3e50, #34495e);
            color: white;
        }

        .status-unknown-badge {
            background: linear-gradient(135deg, #7f8c8d, #95a5a6);
            color: white;
        }

        @keyframes pulse {
            0% { opacity: 1; }
            50% { opacity: 0.8; }
            100% { opacity: 1; }
        }

        /* دليل الألوان للبادجات فقط */
        .color-guide {
            background: #f8f9fa;
            border-radius: 8px;
            padding: 15px;
            margin-top: 20px;
            border: 1px solid var(--border);
        }

        .color-guide h4 {
            color: var(--accent);
            margin-bottom: 10px;
            font-size: 14px;
        }

        .color-guide-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(180px, 1fr));
            gap: 8px;
        }

        .color-guide-item {
            display: flex;
            align-items: center;
            gap: 8px;
            font-size: 11px;
        }

        .color-box {
            width: 15px;
            height: 15px;
            border-radius: 3px;
            flex-shrink: 0;
        }

        /* ========== أنماط جديدة للمباريات القادمة مع التاريخ المحدد ========== */
        .date-not-set-badge {
            background: linear-gradient(135deg, #95a5a6, #7f8c8d);
            color: white;
            padding: 2px 8px;
            border-radius: 10px;
            font-size: 10px;
            font-weight: 600;
        }
        
        .match-with-date {
            background: rgba(46, 204, 113, 0.1) !important;
            border-color: rgba(46, 204, 113, 0.3) !important;
        }
        
        .match-without-date {
            background: rgba(149, 165, 166, 0.1) !important;
            border-color: rgba(149, 165, 166, 0.3) !important;
        }
        
        .upcoming-info {
            background: #e8f4f8;
            border: 1px solid #b8daff;
            border-radius: 8px;
            padding: 15px;
            margin-bottom: 15px;
            color: #004085;
            font-size: 14px;
        }
        
        .upcoming-info h4 {
            margin: 0 0 10px 0;
            color: #0a4a2f;
        }
        
        .upcoming-matches-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 15px;
            padding-bottom: 10px;
            border-bottom: 2px solid var(--accent);
        }
        
        .upcoming-matches-header h3 {
            margin: 0;
            color: var(--accent);
        }
        
        .upcoming-section {
            margin-bottom: 25px;
        }
        
        .upcoming-section-title {
            display: flex;
            align-items: center;
            gap: 10px;
            margin-bottom: 15px;
            padding-bottom: 10px;
            border-bottom: 2px solid var(--border);
        }
        
        .upcoming-section-title h3 {
            margin: 0;
            color: var(--accent);
        }
        
        .upcoming-section-title .badge {
            background: var(--accent);
            color: white;
            padding: 3px 10px;
            border-radius: 15px;
            font-size: 12px;
        }
        
        /* ========== أنماط جديدة للفرق في حالة راحة ========== */
        .resting-team {
            background: #f8f9fa;
            margin: 5px 0;
            padding: 10px;
            border-radius: 6px;
            border: 1px dashed #b8daff;
            color: #0056b3;
            font-style: italic;
            text-align: center;
            font-size: 13px;
            transition: all 0.3s;
        }
        
        .resting-team:hover {
            background: #e8f4f8;
            transform: translateX(3px);
        }
        
        .resting-header {
            background: linear-gradient(135deg, #6c757d, #495057);
            color: white;
            padding: 10px 15px;
            font-size: 14px;
            font-weight: 700;
            margin-top: 15px;
            border-radius: 6px;
            display: flex;
            align-items: center;
            gap: 8px;
        }
        
        .resting-header::before {
            content: "💤";
            font-size: 16px;
        }
        
        /* ========== أنماط جديدة لنافذة تفاصيل المباراة الملونة ========== */
        .match-details-header.upcoming {
            background: linear-gradient(135deg, #3498db, #2980b9);
        }
        
        .match-details-header.live {
            background: linear-gradient(135deg, #e74c3c, #c0392b);
        }
        
        .match-details-header.live-no-results {
            background: linear-gradient(135deg, #e67e22, #d35400);
        }
        
        .match-details-header.completed-confirmed {
            background: linear-gradient(135deg, #27ae60, #229954);
        }
        
        .match-details-header.completed-unconfirmed {
            background: linear-gradient(135deg, #3498db, #2980b9);
        }
        
        .match-details-header.past-no-results {
            background: linear-gradient(135deg, #95a5a6, #7f8c8d);
        }
        
        .match-details-header.postponed {
            background: linear-gradient(135deg, #f39c12, #e67e22);
        }
        
        .match-details-header.withdrawal-team1,
        .match-details-header.withdrawal-team2 {
            background: linear-gradient(135deg, #8e44ad, #732d91);
        }
        
        .match-details-header.stopped {
            background: linear-gradient(135deg, #2c3e50, #34495e);
        }
        
        .match-details-header.unknown {
            background: linear-gradient(135deg, #7f8c8d, #95a5a6);
        }
        
        /* ========== أنماط جديدة للبرنامج مع الفرق الراحلة ========== */
        .program-resting-teams {
            background: #e8f4f8;
            margin: 10px;
            padding: 12px;
            border-radius: 8px;
            border: 1px dashed #b8daff;
        }
        
        .program-resting-teams h4 {
            color: #0056b3;
            margin-bottom: 8px;
            display: flex;
            align-items: center;
            gap: 8px;
        }
        
        .program-resting-teams h4::before {
            content: "💤";
            font-size: 16px;
        }
        
        .resting-teams-list {
            display: flex;
            flex-wrap: wrap;
            gap: 8px;
            justify-content: center;
        }
        
        .resting-team-item {
            background: white;
            padding: 6px 12px;
            border-radius: 15px;
            border: 1px solid #b8daff;
            color: #0056b3;
            font-size: 12px;
            transition: all 0.3s;
        }
        
        .resting-team-item:hover {
            background: #d0e7ff;
            transform: translateY(-2px);
        }

        /* ========== تحسينات للهواتف ========== */
        @media (max-width: 768px) {
            /* تحسين عرض الفرق جنباً إلى جنب على الهاتف */
            .match .teams {
                flex-direction: row !important;
                gap: 10px;
            }
            
            .match .team {
                width: auto !important;
                flex: 1;
                text-align: center;
                font-size: 12px;
            }
            
            .match-result {
                margin: 0 5px !important;
                min-width: 40px;
            }
            
            /* تحسين جدول الترتيب للهواتف */
            .standings-container {
                overflow-x: auto;
                -webkit-overflow-scrolling: touch;
                margin: 0 -10px;
                padding: 0 10px;
            }
            
            /* تصغير أحجام الأعمدة للهواتف */
            .standings-table {
                min-width: 750px;
                font-size: 11px;
            }
            
            .standings-table th,
            .standings-table td {
                padding: 4px 3px !important;
                font-size: 10px;
            }
            
            /* تحديد عرض أصغر للأعمدة على الهواتف */
            .standings-table th:nth-child(1),
            .standings-table td:nth-child(1) {
                width: 10px;
                min-width: 10px;
                max-width: 20px;
            }
            
            .standings-table th:nth-child(2),
            .standings-table td:nth-child(2) {
                width: 30px;
                min-width: 20px;
                max-width: 70px;
                padding-right: 8px;
            }
            
            .standings-table th:nth-child(3),
            .standings-table td:nth-child(3),
            .standings-table th:nth-child(4),
            .standings-table td:nth-child(4),
            .standings-table th:nth-child(5),
            .standings-table td:nth-child(5),
            .standings-table th:nth-child(6),
            .standings-table td:nth-child(6) {
                width: 30px;
                min-width: 30px;
                max-width: 30px;
            }
            
            .standings-table th:nth-child(7),
            .standings-table td:nth-child(7),
            .standings-table th:nth-child(8),
            .standings-table td:nth-child(8) {
                width: 35px;
                min-width: 35px;
                max-width: 35px;
            }
            
            .standings-table th:nth-child(9),
            .standings-table td:nth-child(9) {
                width: 40px;
                min-width: 40px;
                max-width: 40px;
            }
            
            .standings-table th:nth-child(10),
            .standings-table td:nth-child(10) {
                width: 45px;
                min-width: 45px;
                max-width: 45px;
            }
            
            .standings-table th:nth-child(11),
            .standings-table td:nth-child(11),
            .standings-table th:nth-child(12),
            .standings-table td:nth-child(12) {
                width: 40px;
                min-width: 40px;
                max-width: 40px;
            }
            
            .team-name-cell {
                min-width: 120px;
                max-width: 120px;
                overflow: hidden;
                text-overflow: ellipsis;
                white-space: nowrap;
                text-align: right !important;
            }
            
            /* إضافة مؤشر السحب الأفقي */
            .standings-container::-webkit-scrollbar {
                height: 4px;
            }
            
            .standings-container::-webkit-scrollbar-track {
                background: #f1f1f1;
                border-radius: 2px;
            }
            
            .standings-container::-webkit-scrollbar-thumb {
                background: var(--accent);
                border-radius: 2px;
            }
            
            .standings-container::-webkit-scrollbar-thumb:hover {
                background: #09482c;
            }
            
            /* تحسين الروؤوس في الجدول */
            .standings-table th {
                white-space: nowrap;
                font-size: 10px;
                padding: 5px 3px !important;
            }
            
            /* تحسين عرض البادجات في المباريات */
            .badges-container {
                flex-wrap: wrap;
                gap: 3px;
                justify-content: center;
            }
            
            .match-badge, .round-badge, .status-badge {
                font-size: 9px !important;
                padding: 1px 4px !important;
            }
            
            /* تحسينات أخرى للهواتف */
            .news-main-slider {
                min-height: 450px;
            }
            
            .article-image-container {
                height: 200px;
            }
            
            .news-image-container {
                height: 150px;
            }
            
            .news-title {
                font-size: 16px;
            }
            
            .news-excerpt {
                font-size: 13px;
            }
            
            .news-slider-controls {
                flex-direction: column;
                gap: 10px;
            }
            
            .article-container {
                max-height: 85vh;
            }
            
            .article-content {
                padding: 20px;
            }
            
            .ad-space {
                height: 150px;
            }
            
            .ad-space .ad-title {
                font-size: 10px;
                padding: 3px 6px;
            }
            
            .matches-nav-btn {
                padding: 10px 15px;
                font-size: 12px;
            }
            
            .match-time-date {
                flex-direction: column;
                gap: 2px;
            }
            
            .round-match-teams {
                flex-direction: column;
                gap: 8px;
            }
            
            .round-match-details {
                flex-direction: column;
                gap: 3px;
            }
            
            .match-info-grid {
                grid-template-columns: 1fr;
            }
            
            .match-score-display {
                padding: 15px;
            }
            
            .match-score-team-name {
                font-size: 16px;
            }
            
            .match-score-goals {
                font-size: 36px;
                padding: 10px 20px;
                min-width: 80px;
            }
            
            .match-score-vs {
                font-size: 20px;
                margin: 0 15px;
            }
            
            .previous-rounds-grid {
                grid-template-columns: 1fr;
            }
            
            .program-rounds-grid {
                grid-template-columns: 1fr;
            }
            
            .color-guide-grid {
                grid-template-columns: repeat(2, 1fr);
            }
        }

        /* تحسينات للشاشات الكبيرة */
        @media (min-width: 1200px) {
            .article-image-container {
                height: 350px;
            }
            
            .news-image-container {
                height: 250px;
            }
            
            /* يمكن زيادة عرض بعض الأعمدة قليلاً على الشاشات الكبيرة */
            .standings-table th:nth-child(2),
            .standings-table td:nth-child(2) {
                width: 40px;
                min-width: 30px;
                max-width: 80px;
            }
        }

        /* ========== إضافات جديدة لجدول الترتيب المصغر ========== */
        .mini-standings-container {
            max-height: 300px;
            overflow-y: auto;
            border: 1px solid var(--border);
            border-radius: 8px;
            margin-top: 10px;
            position: relative;
            cursor: pointer;
            transition: all 0.3s;
        }

        .mini-standings-container:hover {
            box-shadow: 0 5px 15px rgba(0,0,0,0.1);
            border-color: var(--accent);
        }

        .mini-standings-table {
            width: 100%;
            border-collapse: collapse;
            font-size: 20px !important;
            min-width: 100% !important;
        }

        .mini-standings-table th,
        .mini-standings-table td {
            padding: 5px 12px !important;
            text-align: center;
            white-space: nowrap;
            font-size: 9px !important;
        }

        .mini-standings-table th {
            background: rgba(11, 93, 59, 0.1);
            color: var(--accent);
            font-weight: 600;
            position: sticky;
            top: 0;
            z-index: 10;
        }

        .mini-standings-table th:nth-child(1),
        .mini-standings-table td:nth-child(1) {
            width: 5px !important;
            min-width: 5px !important;
        }

        .mini-standings-table th:nth-child(2),
        .mini-standings-table td:nth-child(2) {
            width: 30px !important;
            min-width: 30px !important;
            text-align: right;
            padding-right: 5px !important;
        }

        .mini-standings-table th:nth-child(3),
        .mini-standings-table td:nth-child(3) {
            width: 10px !important;
            min-width:10px !important;
            font-weight: bold;
        }

        .mini-standings-table th:nth-child(4),
        .mini-standings-table td:nth-child(4) {
            width: 10px !important;
            min-width: 10px !important;
        }

        .mini-standings-table th:nth-child(5),
        .mini-standings-table td:nth-child(5) {
            width: 8px !important;
            min-width: 8px !important;
        }

        .mini-standings-table th:nth-child(6),
        .mini-standings-table td:nth-child(6) {
            width: 10px !important;
            min-width: 10px !important;
        }

        .mini-standings-table th:nth-child(7),
        .mini-standings-table td:nth-child(7) {
            width: 10px !important;
            min-width: 10px !important;
        }

        .mini-standings-table th:nth-child(8),
        .mini-standings-table td:nth-child(8) {
            width: 10px !important;
            min-width: 10px !important;
        }

        .mini-standings-table th:nth-child(9),
        .mini-standings-table td:nth-child(9) {
            width: 10px !important;
            min-width: 10px !important;
        }

        .mini-standings-container::after {
            content: "انقر لعرض الجدول الكامل";
            position: absolute;
            bottom: 0;
            left: 0;
            right: 0;
            background: var(--accent);
            color: white;
            text-align: center;
            padding: 5px;
            font-size: 10px;
            border-bottom-left-radius: 8px;
            border-bottom-right-radius: 8px;
        }

        /* نافذة الجدول الكامل */
        .standings-overlay {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.85);
            display: none;
            justify-content: center;
            align-items: center;
            z-index: 2000;
            padding: 20px;
        }

        .standings-overlay.active {
            display: flex;
        }

        .standings-container-full {
            background: white;
            border-radius: 15px;
            width: 100%;
            max-width: 95%;
            max-height: 90vh;
            overflow: hidden;
            display: flex;
            flex-direction: column;
            box-shadow: 0 20px 50px rgba(0,0,0,0.3);
        }

        .standings-header {
            background: linear-gradient(135deg, var(--accent), #0a4a2f);
            color: white;
            padding: 20px 30px;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .standings-header h2 {
            margin: 0;
            font-size: 24px;
            font-weight: 700;
        }

        .close-standings {
            background: rgba(255,255,255,0.2);
            border: none;
            color: white;
            width: 40px;
            height: 40px;
            border-radius: 50%;
            font-size: 22px;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            transition: all 0.3s;
        }

        .close-standings:hover {
            background: rgba(255,255,255,0.3);
            transform: rotate(90deg);
        }

        .standings-content {
            padding: 25px;
            overflow-y: auto;
            flex: 1;
        }

        .full-standings-table {
            width: 100%;
            border-collapse: collapse;
            margin-top: 20px;
            font-size: 14px;
        }

        .full-standings-table th,
        .full-standings-table td {
            padding: 12px 15px;
            text-align: center;
            border-bottom: 1px solid var(--border);
        }

        .full-standings-table th {
            background: rgba(11, 93, 59, 0.1);
            color: var(--accent);
            font-weight: 700;
            font-size: 15px;
            position: sticky;
            top: 0;
            z-index: 10;
        }

        .full-standings-table tr:hover {
            background: rgba(11, 93, 59, 0.05);
        }

        .standings-info {
            background: #f8f9fa;
            padding: 15px;
            border-radius: 8px;
            margin-top: 20px;
            border: 1px solid var(--border);
        }

        .standings-info h4 {
            color: var(--accent);
            margin-bottom: 10px;
        }

        .standings-info-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(200px, 1fr));
            gap: 10px;
            font-size: 13px;
        }

        .standings-info-item {
            display: flex;
            align-items: center;
            gap: 8px;
        }
    </style>
</head>
<body>
    <!-- الشريط العلوي مع التاريخ والوقت -->
    <div class="top-bar">
        <div class="wrap">
            <div class="datetime-container">
                <div id="currentDateTimeArabic" class="datetime-arabic"></div>
                <div id="currentDateTimeFrench" class="datetime-french"></div>
            </div>
        </div>
    </div>

    <div class="wrap">
        <!-- العنوان الرئيسي مع الشعار -->
        <header class="site-header">
            <div class="brand">
                <div class="logo">
                    <img src="logo.png">
                </div>
                <div class="brand-text">
                    <h1>هواة الشمال</h1>
                    <div class="subtitle">أخبار الشباب الممارس لكرة القدم المنضوي تحت لواء العصبة الجهوية لطنجة تطوان الحسيمة لكرة القدم</div>
                </div>
            </div>
        </header>

        <!-- وصف الموقع -->
        <div class="site-description">
            رسالتنا تتجاوز متابعة الألعاب والنتائج، إلى بناء وعي مجتمعي بأهمية الرياضة كرافعة للتنمية البشرية، وأداة فعالة لصناعة جيل متوازن، معافى، وطموح. كما نؤمن أيضا بأن الملاعب الخضراء ليست مجرد مساحات للرياضة، وإنما معامل حقيقية لصناعة الشخصية المتكاملة، والقيم النبيلة، والروح التنافسية الشريفة
            ففي هذا الفضاء الإلكتروني المتخصص، نكتب بأقلام محبة، نتابع بعيون خبيرة، وننقل بقلوب مؤمنة بمستقبل كرة القدم المغربية، التي تبدأ خطواتها الأول على ملاعب عصبة طنجة تطوان الحسيمة، لتنتهي بإذن الله على منصات التتويج العالمية
        </div>

        <!-- نافذة المقال الكامل -->
        <div class="article-overlay" id="articleOverlay">
            <div class="article-container">
                <div class="article-header">
                    <h2 id="articleTitle">عنوان المقال</h2>
                    <button class="close-article" onclick="closeFullArticle()">×</button>
                </div>
                <div class="article-content" id="articleContent">
                    <!-- سيتم ملؤها بالجافاسكريبت -->
                </div>
            </div>
        </div>

        <!-- نافذة تفاصيل المباراة -->
        <div class="match-details-overlay" id="matchDetailsOverlay">
            <div class="match-details-container">
                <div class="match-details-header" id="matchDetailsHeader">
                    <h2 id="matchDetailsTitle">تفاصيل المباراة</h2>
                    <button class="close-match-details" onclick="closeMatchDetails()">×</button>
                </div>
                <div class="match-details-content" id="matchDetailsContent">
                    <!-- سيتم ملؤها بالجافاسكريبت -->
                </div>
            </div>
        </div>

        <!-- نافذة الجدول الكامل -->
        <div class="standings-overlay" id="standingsOverlay">
            <div class="standings-container-full" id="standingsContainerFull">
                <div class="standings-header">
                    <h2 id="standingsTitle">جدول الترتيب الكامل</h2>
                    <button class="close-standings" onclick="closeFullStandings()">×</button>
                </div>
                <div class="standings-content" id="standingsContent">
                    <!-- سيتم ملؤها بالجافاسكريبت -->
                </div>
            </div>
        </div>

        <!-- المحتوى الرئيسي -->
        <div id="home" class="page-content active">
            <!-- التخطيط الرئيسي باستخدام Grid -->
            <div class="main-content-grid">
                <!-- الجانب الأيسر - المباريات -->
                <aside class="left-column">
                    <!-- تبويبات المباريات -->
                    <div class="section" style="padding: 0; overflow: hidden;">
                        <div class="matches-nav">
                            <button class="matches-nav-btn active" data-tab="today">مباريات اليوم</button>
                            <button class="matches-nav-btn" data-tab="upcoming">المباريات القادمة</button>
                            <button class="matches-nav-btn" data-tab="previous">المباريات السابقة</button>
                        </div>
                        
                        <div class="matches-container">
                            <!-- مؤشر التمرير -->
                            <div class="scroll-indicator">اسحب للتمرير</div>
                            
                            <!-- محتوى مباريات اليوم -->
                            <div id="todayMatchesTab" class="matches-tab active">
                                <div id="todayMatchesContainer">
                                    <div class="today-matches-loading">جاري تحميل مباريات اليوم...</div>
                                </div>
                            </div>
                            
                            <!-- محتوى المباريات القادمة -->
                            <div id="upcomingMatchesTab" class="matches-tab">
                                <div id="upcomingMatchesContainer">
                                    <div class="today-matches-loading">جاري تحميل المباريات القادمة...</div>
                                </div>
                            </div>
                            
                            <!-- محتوى المباريات السابقة -->
                            <div id="previousMatchesTab" class="matches-tab">
                                <div id="previousMatchesContainer">
                                    <div class="today-matches-loading">جاري تحميل المباريات السابقة...</div>
                                </div>
                            </div>
                        </div>
                    </div>
                </aside>

                <!-- العمود الأوسط - الأخبار والأقسام والمجموعات -->
                <main class="center-column">
                    <!-- قسم الأخبار الرئيسية في الأعلى -->
                    <div class="news-main-section" id="newsMainSection">
                        <div class="news-main-header">
                            <h2>الأخبار الرئيسية</h2>
                            <div class="news-autoplay-control">
                                <span>تشغيل تلقائي</span>
                                <div class="autoplay-toggle active" id="autoplayToggle"></div>
                            </div>
                        </div>
                        
                        <div class="news-main-slider" id="newsMainSlider">
                            <!-- سيتم ملؤها ديناميكيًا من قاعدة البيانات -->
                            <div class="loading-data">جاري تحميل الأخبار...</div>
                        </div>
                        
                        <div class="news-slider-controls">
                            <div class="news-slider-nav">
                                <button class="news-slider-btn" id="prevNews">❮</button>
                                <div class="news-slider-dots" id="newsDots">
                                    <!-- سيتم ملؤها بالجافاسكريبت -->
                                </div>
                                <button class="news-slider-btn" id="nextNews">❯</button>
                            </div>
                        </div>
                    </div>

                    <!-- مربع الأقسام والمجموعات أسفل الأخبار -->
                    <div class="section">
                        <h1>أقسام و مجموعات</h1>
                        <h4>العصبة الجهوية طنجة-تطوان-الحسيمة لكرة القدم</h4>
                        
                        <!-- حاوية الأقسام والمجموعات -->
                        <div id="divisionsContainer" class="divisions-container">
                            <!-- سيتم ملء هذا القسم ديناميكياً -->
                        </div>
                        
                        <!-- حاوية معلومات المجموعة -->
                        <div id="groupInfoContainer" class="group-info">
                            <!-- سيتم ملء هذا القسم ديناميكياً -->
                        </div>
                    </div>
                </main>

                <!-- الجانب الأيمن - الإعلانات والتواصل -->
                <aside class="right-column">
                    <!-- الإعلانات -->
                    <div class="section">
                        <h2>مساحة إعلانية</h2>
                        <div class="ad-space" id="adSpace">
                            <img src="howatchamal.png">
                        </div>
                    </div>

                    <!-- التواصل -->
                    <div class="section">
                        <h2>التواصل</h2>
                        <div class="contact-info">
                            <p><strong>البريد الإلكتروني:</strong> moh2982004@gmail.com</p>
                            <p><strong>الهاتف:</strong> 0675069172</p>
                        </div>
                    </div>
                </aside>
            </div>
        </div>

        <!-- التذييل -->
        <footer>
            <div class="wrap">
                مع تحيات محمد العبد
            </div>
        </footer>
    </div>

<script>
// ========== المتغيرات العامة ==========
const FIREBASE_BASE_URL = "https://howat-282e5-default-rtdb.europe-west1.firebasedatabase.app/";
const VISIT_COUNTER_URL = `${FIREBASE_BASE_URL}ChamalV/visitCount.json`;
const MATCHES_URL = `${FIREBASE_BASE_URL}matches.json`;

// ========== الدوال المساعدة ==========
const Helper = {
    async fetchData(url) {
        try {
            const response = await fetch(url);
            if (!response.ok) throw new Error('فشل في جلب البيانات');
            const data = await response.json();
            return data || {};
        } catch (error) {
            console.error('خطأ في جلب البيانات:', error);
            return {};
        }
    },
    
    async postData(url, data) {
        try {
            const response = await fetch(url, {
                method: 'POST',
                headers: { 'Content-Type': 'application/json' },
                body: JSON.stringify(data)
            });
            return response.ok;
        } catch (error) {
            console.error('خطأ في إرسال البيانات:', error);
            return false;
        }
    },
    
    getTodayDate() {
        const now = new Date();
        const year = now.getFullYear();
        const month = String(now.getMonth() + 1).padStart(2, '0');
        const day = String(now.getDate()).padStart(2, '0');
        return `${year}-${month}-${day}`;
    },
    
    formatArabicDate(dateString) {
        if (!dateString) return "تاريخ غير محدد";
        try {
            const date = new Date(dateString);
            const weekdays = ['الأحد', 'الإثنين', 'الثلاثاء', 'الأربعاء', 'الخميس', 'الجمعة', 'السبت'];
            const months = ['يناير', 'فبراير', 'مارس', 'أبريل', 'مايو', 'يونيو', 'يوليو', 'أغسطس', 'سبتمبر', 'أكتوبر', 'نوفمبر', 'ديسمبر'];
            
            return `${weekdays[date.getDay()]}، ${date.getDate()} ${months[date.getMonth()]} ${date.getFullYear()}`;
        } catch {
            return dateString;
        }
    },
    
    // دالة جديدة لتنسيق الوقت
    formatTime(timeString) {
        if (!timeString) return "";
        return timeString;
    },
    
    // دالة جديدة للتحقق إذا كان التاريخ في المستقبل (في حدود أسبوعين)
    isDateInFutureWithinTwoWeeks(dateString) {
        if (!dateString) return false;
        
        try {
            const now = new Date();
            const matchDate = new Date(dateString);
            
            // حساب الفرق بالأيام
            const diffTime = matchDate - now;
            const diffDays = Math.ceil(diffTime / (1000 * 60 * 60 * 24));
            
            // إذا كان التاريخ في المستقبل (يوم 0 يعني اليوم، نعتبره مستقبلاً)
            // وفي حدود أسبوعين (14 يوم)
            return diffDays >= 0 && diffDays <= 14;
        } catch (error) {
            console.error('خطأ في حساب الفرق الزمني:', error);
            return false;
        }
    },
    
    // دالة جديدة للتحقق إذا كان التاريخ والساعة محددين
    isDateAndTimeSet(match) {
        return match.تاريخ && match.تاريخ.trim() !== '' && 
               match.الساعة && match.الساعة.trim() !== '';
    },
    
    // دالة جديدة لحساب الفرق بالأيام بين تاريخين
    getDaysDifference(dateString) {
        if (!dateString) return Infinity;
        
        try {
            const now = new Date();
            const matchDate = new Date(dateString);
            
            // حساب الفرق بالأيام
            const diffTime = matchDate - now;
            return Math.ceil(diffTime / (1000 * 60 * 60 * 24));
        } catch (error) {
            return Infinity;
        }
    },
    
    // دالة جديدة للتحقق إذا كان التاريخ فارغاً أو غير محدد
    isDateEmpty(dateString) {
        return !dateString || dateString.trim() === '' || dateString === 'undefined' || dateString === 'null';
    },
    
    // دالة جديدة للتحقق إذا كان الوقت فارغاً أو غير محدد
    isTimeEmpty(timeString) {
        return !timeString || timeString.trim() === '' || timeString === 'undefined' || timeString === 'null' || timeString === '00:00';
    }
};

// ========== نظام حالة المباريات والتصنيف الزمني ==========
const MatchStatusSystem = {
    // تحديد حالة المباراة بناءً على الوقت والبيانات
    determineMatchStatus(match) {
        const now = new Date();
        
        // إذا كانت المباراة مؤجلة
        if (match.تأجيل === true) {
            return 'postponed'; // مؤجلة
        }
        
        // إذا كان هناك انسحاب
        if (match["انسحاب الفريق 1"] === true) {
            return 'withdrawal-team1'; // انسحاب الفريق 1
        }
        
        if (match["انسحاب الفريق 2"] === true) {
            return 'withdrawal-team2'; // انسحاب الفريق 2
        }
        
        // إذا تم إيقاف المباراة
        if (match["توقف المباراة"] === true) {
            return 'stopped'; // متوقفة
        }
        
        // إذا لم يكن هناك تاريخ وساعة محددين
        if (Helper.isDateEmpty(match.تاريخ) || Helper.isTimeEmpty(match.الساعة)) {
            return 'unknown';
        }
        
        const matchDate = new Date(match.تاريخ);
        const matchTime = match.الساعة || "00:00";
        
        // حساب وقت بداية المباراة
        const [hours, minutes] = matchTime.split(':').map(Number);
        const matchStartTime = new Date(matchDate);
        matchStartTime.setHours(hours, minutes, 0, 0);
        
        // حساب وقت انتهاء المباراة (بداية + 90 دقيقة + 15 دقيقة إضافية)
        const matchEndTime = new Date(matchStartTime);
        matchEndTime.setMinutes(matchEndTime.getMinutes() + 105); // 90 + 15 دقيقة
        
        // إذا كان الوقت الحالي قبل بداية المباراة
        if (now < matchStartTime) {
            return 'upcoming'; // قادمة
        }
        
        // إذا كان الوقت الحالي بين بداية ونهاية المباراة
        if (now >= matchStartTime && now <= matchEndTime) {
            // إذا كان هناك أهداف مسجلة
            if (match["اهداف 1"] !== undefined && match["اهداف 2"] !== undefined) {
                return 'live'; // مباشرة مع نتائج
            }
            return 'live-no-results'; // مباشرة بدون نتائج
        }
        
        // إذا تجاوز الوقت انتهاء المباراة
        if (now > matchEndTime) {
            // إذا كانت المباراة مصادق عليها
            if (match["المصادقة"] === true) {
                return 'completed-confirmed'; // مكتملة ومصادق عليها
            }
            
            // إذا كان هناك أهداف مسجلة ولكن غير مصادق عليها
            if (match["اهداف 1"] !== undefined && match["اهداف 2"] !== undefined) {
                return 'completed-unconfirmed'; // مكتملة وغير مصادقة
            }
            
            // إذا تجاوز الوقت ولم تسجل نتائج
            return 'past-no-results'; // انتهت بدون نتائج
        }
        
        return 'unknown';
    },
    
    // الحصول على فئة البادج حسب الحالة
    getStatusBadgeClass(status) {
        const classes = {
            'upcoming': 'status-upcoming-badge',
            'live': 'status-live-badge',
            'live-no-results': 'status-live-no-results-badge',
            'completed-confirmed': 'status-completed-confirmed-badge',
            'completed-unconfirmed': 'status-completed-unconfirmed-badge',
            'past-no-results': 'status-past-no-results-badge',
            'postponed': 'status-postponed-badge',
            'withdrawal-team1': 'status-withdrawal-team1-badge',
            'withdrawal-team2': 'status-withdrawal-team2-badge',
            'stopped': 'status-stopped-badge',
            'unknown': 'status-unknown-badge'
        };
        return classes[status] || 'status-unknown-badge';
    },
    
    // الحصول على فئة الهيدر حسب الحالة
    getHeaderClass(status) {
        const classes = {
            'upcoming': 'upcoming',
            'live': 'live',
            'live-no-results': 'live-no-results',
            'completed-confirmed': 'completed-confirmed',
            'completed-unconfirmed': 'completed-unconfirmed',
            'past-no-results': 'past-no-results',
            'postponed': 'postponed',
            'withdrawal-team1': 'withdrawal-team1',
            'withdrawal-team2': 'withdrawal-team2',
            'stopped': 'stopped',
            'unknown': 'unknown'
        };
        return classes[status] || 'unknown';
    },
    
    // الحصول على نص الحالة بالعربية
    getStatusText(status) {
        const texts = {
            'upcoming': 'قادمة',
            'live': 'مباشرة',
            'live-no-results': 'مباشرة - بانتظار النتائج',
            'completed-confirmed': 'مصادق عليها',
            'completed-unconfirmed': 'مكتملة',
            'past-no-results': 'بانتظار النتائج',
            'postponed': 'مؤجلة',
            'withdrawal-team1': 'انسحاب الفريق 1',
            'withdrawal-team2': 'انسحاب الفريق 2',
            'stopped': 'متوقفة',
            'unknown': 'لم يحدد موعدها بعد'
        };
        return texts[status] || 'حالة غير معروفة';
    },
    
    // الحصول على نتيجة المباراة مع تنسيق مناسب
    getMatchResult(match, status) {
        if (status === 'postponed') {
            return '<span style="color: #f39c12;">مؤجلة</span>';
        }
        
        if (status === 'withdrawal-team1') {
            return '<span style="color: #e74c3c;">انسحاب - 3/0</span>';
        }
        
        if (status === 'withdrawal-team2') {
            return '<span style="color: #e74c3c;">انسحاب - 0/3</span>';
        }
        
        if (status === 'stopped') {
            return '<span style="color: #2c3e50;">متوقفة</span>';
        }
        
        if (status === 'past-no-results') {
            return '<span style="color: #95a5a6; font-style: italic;">بانتظار النتائج</span>';
        }
        
        if (status === 'live-no-results') {
            return '<span style="color: #e67e22;">مباشر - بانتظار النتائج</span>';
        }
        
        if (match["اهداف 1"] !== undefined && match["اهداف 2"] !== undefined) {
            return `<strong>${match["اهداف 1"]} - ${match["اهداف 2"]}</strong>`;
        }
        
        if (status === 'upcoming') {
            return '<span style="color: var(--muted);">VS</span>';
        }
        
        if (status === 'live') {
            return '<span style="color: #e74c3c;">مباشر</span>';
        }
        
        if (status === 'unknown') {
            return '<span style="color: #95a5a6; font-style: italic;">لم يحدد</span>';
        }
        
        return '<span style="color: #95a5a6;">--</span>';
    },
    
    // فحص إذا كانت المبارية في الماضي (انتهى وقتها)
    isPastMatch(match) {
        const now = new Date();
        
        // إذا لم يكن هناك تاريخ، لا تعتبر من الماضي
        if (Helper.isDateEmpty(match.تاريخ)) {
            return false;
        }
        
        const matchDate = new Date(match.تاريخ);
        const matchTime = match.الساعة || "00:00";
        
        const [hours, minutes] = matchTime.split(':').map(Number);
        const matchStartTime = new Date(matchDate);
        matchStartTime.setHours(hours, minutes, 0, 0);
        
        // وقت نهاية المباراة (بداية + 90 دقيقة)
        const matchEndTime = new Date(matchStartTime);
        matchEndTime.setMinutes(matchEndTime.getMinutes() + 90);
        
        return now > matchEndTime;
    },
    
    // الحصول على آخر دورة مكتملة في مجموعة معينة
    getLastCompletedRoundInGroup(matches, section, group) {
        // تصفية المباريات حسب القسم والمجموعة
        const groupMatches = matches.filter(m => 
            m.القسم === section && 
            m.المجموعة === group
        );
        
        if (groupMatches.length === 0) return 0;
        
        // الحصول على المباريات التي انتهت (لها نتائج أو حالة خاصة)
        const completedMatches = groupMatches.filter(match => {
            const status = this.determineMatchStatus(match);
            return [
                'completed-confirmed',
                'completed-unconfirmed',
                'postponed',
                'withdrawal-team1',
                'withdrawal-team2',
                'stopped'
            ].includes(status);
        });
        
        if (completedMatches.length === 0) return 0;
        
        // الحصول على آخر دورة
        const lastRound = Math.max(...completedMatches.map(m => m.الدورة || 0));
        return lastRound;
    },
    
    // دالة جديدة للتحقق إذا كانت المباراة قادمة (في المستقبل)
    isUpcomingMatch(match) {
        const status = this.determineMatchStatus(match);
        return status === 'upcoming';
    },
    
    // دالة جديدة للتحقق إذا كانت المباراة لها تاريخ محدد
    hasScheduledDate(match) {
        return !Helper.isDateEmpty(match.تاريخ) && !Helper.isTimeEmpty(match.الساعة);
    }
};

// ========== نظام استخراج الأقسام والمجموعات من المباريات ==========
const DynamicDivisionsManager = {
    allMatches: [],
    
    async initialize() {
        try {
            // جلب جميع المباريات
            this.allMatches = await this.getAllMatches();
            
            if (this.allMatches.length === 0) {
                const container = document.getElementById('divisionsContainer');
                container.innerHTML = '<div class="today-matches-empty">لا توجد مباريات متاحة</div>';
                return;
            }
            
            // استخراج الأقسام والمجموعات
            const divisions = this.extractDivisionsFromMatches(this.allMatches);
            
            // عرضها في الحاوية
            this.displayDivisionsInContainer(divisions);
            
        } catch (error) {
            console.error('خطأ في تحميل الأقسام:', error);
            const container = document.getElementById('divisionsContainer');
            container.innerHTML = '<div class="loading-data">حدث خطأ في تحميل الأقسام</div>';
        }
    },
    
    async getAllMatches() {
        try {
            const data = await Helper.fetchData(MATCHES_URL);
            
            // دعم هيكل JSON الجديد مع matches.matches
            if (data && data.matches && Array.isArray(data.matches)) {
                return data.matches;
            }
            
            // دعم الهيكل القديم
            if (data && Array.isArray(data)) {
                return data;
            }
            
            return [];
        } catch (error) {
            console.error('خطأ في جلب المباريات:', error);
            return [];
        }
    },
    
    // ========== تعديل دالة استخراج الأقسام لحساب عدد الفرق ==========
    extractDivisionsFromMatches(matches) {
        const divisionsMap = {};
        
        matches.forEach(match => {
            const section = match.القسم || 'غير محدد';
            const group = match.المجموعة || 'غير محدد';
            
            if (!divisionsMap[section]) {
                divisionsMap[section] = {
                    name: section,
                    groups: new Set(),
                    matches: [],
                    teams: new Set()
                };
            }
            
            // إضافة المجموعة
            divisionsMap[section].groups.add(group);
            // إضافة المباراة للقسم
            divisionsMap[section].matches.push(match);
            
            // إضافة الفريق 1
            if (match["الفريق 1"]) {
                divisionsMap[section].teams.add(`${group}_${match["الفريق 1"]}`);
            }
            
            // إضافة الفريق 2
            if (match["الفريق 2"]) {
                divisionsMap[section].teams.add(`${group}_${match["الفريق 2"]}`);
            }
        });
        
        // تحويل إلى مصفوفة مرتبة
        return Object.values(divisionsMap)
            .map(division => ({
                ...division,
                groups: Array.from(division.groups).sort(),
                groupCount: division.groups.size,
                matchCount: division.matches.length,
                teamCount: division.teams.size
            }))
            .sort((a, b) => {
                // ترتيب الأقسام حسب الأهمية
                const order = { 'ممتاز': 1, 'أول': 2, 'ثاني': 3 };
                const orderA = order[a.name] || 999;
                const orderB = order[b.name] || 999;
                return orderA - orderB;
            });
    },
    
    // ========== تعديل دالة عرض الأقسام لتعرض عدد الفرق ==========
    displayDivisionsInContainer(divisions) {
        const container = document.getElementById('divisionsContainer');
        
        if (divisions.length === 0) {
            container.innerHTML = '<div class="today-matches-empty">لا توجد أقسام متاحة</div>';
            return;
        }
        
        let html = '';
        
        divisions.forEach((division, index) => {
            const divisionId = `auto-div-${index}`;
            
            html += `
                <div class="division-header" onclick="DynamicDivisionsManager.toggleDivision('${divisionId}')">
                    <h3>${division.name}</h3>
                    <div style="display: flex; align-items: center; gap: 15px;">
                        <span style="font-size: 12px; color: var(--muted);">
                            ${division.groupCount} مجموعة | ${division.teamCount} فريق
                        </span>
                        <span class="division-arrow">▼</span>
                    </div>
                </div>
                <div class="groups-container" id="${divisionId}-groups" style="display: none;">
            `;
            
            if (division.groups.length === 0) {
                html += '<div class="today-matches-empty" style="grid-column: 1/-1;">لا توجد مجموعات في هذا القسم</div>';
            } else {
                division.groups.forEach((group, groupIndex) => {
                    // حساب عدد الفرق في هذه المجموعة (التعديل هنا)
                    const teamsInGroup = new Set();
                    division.matches.forEach(match => {
                        if (match.المجموعة === group && match.القسم === division.name) {
                            if (match["الفريق 1"]) teamsInGroup.add(match["الفريق 1"]);
                            if (match["الفريق 2"]) teamsInGroup.add(match["الفريق 2"]);
                        }
                    });
                    
                    const teamCount = teamsInGroup.size;
                    
                    // إنشاء البادج حسب نوع القسم
                    let badgeText = '';
                    if (division.name.includes('ممتاز')) {
                        badgeText = `الممتاز ${group}`;
                    } else if (division.name.includes('أول')) {
                        badgeText = `أول ${group}`;
                    } else if (division.name.includes('ثاني')) {
                        badgeText = `ثاني ${group}`;
                    } else {
                        badgeText = `${division.name} ${group}`;
                    }
                    
                    html += `
                        <div class="group-card" onclick="DynamicDivisionsManager.showGroupInfo('${division.name}','${group}', '${badgeText}')">
                            <h4>المجموعة ${group}</h4>
                            <div>
                                <p>${teamCount} فريق</p>
                            </div>
                        </div>
                    `;
                });
            }
            
            html += `</div>`;
        });
        
        container.innerHTML = html;
    },
    
    toggleDivision(divisionId) {
        const header = document.querySelector(`.division-header[onclick*="${divisionId}"]`);
        const container = document.getElementById(`${divisionId}-groups`);
        
        if (!header || !container) return;
        
        // إغلاق جميع الأقسام الأخرى
        document.querySelectorAll('.division-header').forEach(h => {
            if (h !== header) {
                h.classList.remove('active');
                const onclickAttr = h.getAttribute('onclick');
                if (onclickAttr) {
                    const match = onclickAttr.match(/toggleDivision\('(.+?)'\)/);
                    if (match) {
                        const otherId = match[1];
                        const otherContainer = document.getElementById(`${otherId}-groups`);
                        if (otherContainer) otherContainer.style.display = 'none';
                    }
                }
            }
        });
        
        // تبديل القسم الحالي
        header.classList.toggle('active');
        container.style.display = header.classList.contains('active') ? 'grid' : 'none';
    },
    
    async showGroupInfo(section, group, badge) {
        // إخفاء الأقسام
        document.getElementById('divisionsContainer').style.display = 'none';
        
        // إظهار حاوية معلومات المجموعة
        const groupInfoContainer = document.getElementById('groupInfoContainer');
        groupInfoContainer.classList.add('active');
        
        groupInfoContainer.innerHTML = `
            <button class="back-button" onclick="DynamicDivisionsManager.backToDivisions()">← العودة إلى الأقسام</button>
            <h2 style="display: flex; align-items: center; gap: 10px;">
                <span style="background: var(--accent); color: white; padding: 5px 10px; border-radius: 20px; font-size: 14px;">
                    ${badge}
                </span>
                <span>${group} - ${section}</span>
            </h2>
            <div class="loading-data">جاري تحميل بيانات المجموعة...</div>
        `;
        
        await this.loadGroupData(section, group, badge);
    },
    
    async loadGroupData(section, group, badge) {
        try {
            // تصفية مباريات المجموعة
            const groupMatches = this.allMatches.filter(match => 
                match.القسم === section && match.المجموعة === group
            );
            
            if (groupMatches.length === 0) {
                document.getElementById('groupInfoContainer').innerHTML = `
                    <button class="back-button" onclick="DynamicDivisionsManager.backToDivisions()">← العودة إلى الأقسام</button>
                    <h2>${section} - ${group}</h2>
                    <div class="today-matches-empty">لا توجد مباريات في هذه المجموعة</div>
                `;
                return;
            }
            
            // الحصول على جميع الفرق في المجموعة
            const teamsInGroup = this.getTeamsInGroup(groupMatches);
            const teamCount = teamsInGroup.length;
            
            // الحصول على آخر دورة مكتملة
            const lastCompletedRound = MatchStatusSystem.getLastCompletedRoundInGroup(this.allMatches, section, group);
            
            const groupInfoContainer = document.getElementById('groupInfoContainer');
            
            groupInfoContainer.innerHTML = `
                <button class="back-button" onclick="DynamicDivisionsManager.backToDivisions()">← العودة إلى الأقسام</button>
                <h2 style="display: flex; align-items: center; gap: 10px; margin-bottom: 20px;">
                    <span style="background: var(--accent); color: white; padding: 5px 10px; border-radius: 20px; font-size: 14px;">
                        ${badge}
                    </span>
                    <span>${group} - ${section}</span>
                    <span style="font-size: 14px; color: var(--muted); margin-right: auto;">${teamCount} فريق</span>
                </h2>
                
                <div class="group-tabs">
                    <button class="group-tab active" data-tab="standings">جدول الترتيب</button>
                    <button class="group-tab" data-tab="lastRound">آخر دورة مكتملة</button>
                    <button class="group-tab" data-tab="previousMatches">المباريات السابقة</button>
                    <button class="group-tab" data-tab="upcomingMatches">المباريات القادمة</button>
                    <button class="group-tab" data-tab="program">برنامج الدورات</button>
                </div>
                
                <div class="group-tab-content active" id="standings-tab">
                    ${this.createMiniStandingsTab(groupMatches, section, group)}
                </div>
                
                <div class="group-tab-content" id="lastRound-tab">
                    ${lastCompletedRound > 0 ? 
                        this.createLastRoundTab(groupMatches, lastCompletedRound) : 
                        '<div class="today-matches-empty">لا توجد دورة مكتملة بعد</div>'}
                </div>
                
                <div class="group-tab-content" id="previousMatches-tab">
                    ${this.createPreviousMatchesTab(groupMatches)}
                </div>
                
                <div class="group-tab-content" id="upcomingMatches-tab">
                    ${this.createUpcomingMatchesTab(groupMatches)}
                </div>
                
                <div class="group-tab-content" id="program-tab">
                    ${this.createProgramTab(groupMatches, teamsInGroup)}
                </div>
            `;
            
            // إضافة مستمعات الأحداث للتبويبات
            this.attachGroupTabListeners();
            
        } catch (error) {
            console.error('خطأ في تحميل بيانات المجموعة:', error);
            document.getElementById('groupInfoContainer').innerHTML = `
                <button class="back-button" onclick="DynamicDivisionsManager.backToDivisions()">← العودة إلى الأقسام</button>
                <h2>${section} - ${group}</h2>
                <div class="loading-data">حدث خطأ في تحميل بيانات المجموعة</div>
            `;
        }
    },
    
    // ========== دالة جديدة لإنشاء جدول مصغر ==========
    createMiniStandingsTab(matches, section, group) {
        if (matches.length === 0) {
            return '<div class="today-matches-empty">لا توجد بيانات لجدول الترتيب</div>';
        }
        
        // حساب الترتيب
        const standings = this.calculateStandings(matches);
        
        // حفظ البيانات للاستخدام لاحقاً
        window.currentStandingsData = {
            standings: standings,
            section: section,
            group: group,
            matches: matches
        };
        
        let standingsHTML = `
            <div class="mini-standings-container" onclick="showFullStandings()">
                <table class="mini-standings-table">
                    <thead>
                        <tr>
                            <th>#</th>
                            <th>الفريق</th>
                            <th>نقاط</th>
                            <th>ل</th>
                            <th>ف</th>
                            <th>ت</th>
                            <th>خ</th>
                            <th>له</th>
                            <th>ع</th>
                            <th>±</th>
<th>انسحابات</th>
                            <th>عقوبات</th>
                        </tr>
                    </thead>
                    <tbody>
        `;
        
        standings.forEach((team, index) => {
            const position = index + 1;
            const isPromotion = position <= 2;
            const isRelegation = position > standings.length - 2;
            const rowClass = isPromotion ? 'promotion' : (isRelegation ? 'relegation' : '');
            
            // اختصار اسم الفريق
            const teamName = team.name.length > 15 ? team.name.substring(0, 12) + '...' : team.name;
            
            standingsHTML += `
                <tr class="${rowClass}">
                    <td class="position-cell">${position}</td>
                    <td class="team-name-cell">${teamName}</td>
                    <td class="points-cell">${team.points}</td>
                    <td>${team.played}</td>
                    <td>${team.wins}</td>
                    <td>${team.draws}</td>
                    <td>${team.losses}</td>
                    <td>${team.goalsFor}</td>
                    <td>${team.goalsAgainst}</td>
                    <td>${team.diff > 0 ? '+' : ''}${team.diff}</td>
  <td>${team.withdrawals || 0}</td>
                    <td>${team.penalties || 0}</td>
                </tr>
            `;
        });
        
        standingsHTML += `
                    </tbody>
                </table>
            </div>
            
            <div style="margin-top: 10px; font-size: 10px; color: var(--muted);">
                <div style="display: flex; gap: 10px; flex-wrap: wrap;">
                    <div style="display: flex; align-items: center; gap: 5px;">
                        <div style="width: 10px; height: 10px; background: rgba(46, 204, 113, 0.2); border: 1px solid #27ae60;"></div>
                        <span>ترقية</span>
                    </div>
                    <div style="display: flex; align-items: center; gap: 5px;">
                        <div style="width: 10px; height: 10px; background: rgba(231, 76, 60, 0.2); border: 1px solid #e74c3c;"></div>
                        <span>هبوط</span>
                    </div>
                    <div style="margin-right: auto;">
                        <strong>ل</strong>: لعب - <strong>ف</strong>: فوز - <strong>ت</strong>: تعادل - <strong>خ</strong>: خسارة
                    </div>
                </div>
            </div>
        `;
        
        return standingsHTML;
    },
    
    // ========== دالة جديدة لعرض الجدول الكامل ==========
    createFullStandingsContent() {
        if (!window.currentStandingsData) {
            return '<div class="loading-data">لا توجد بيانات</div>';
        }
        
        const { standings, section, group, matches } = window.currentStandingsData;
        
        let standingsHTML = `
            <div class="standings-info">
                <h4>${section} - المجموعة ${group}</h4>
                <div class="standings-info-grid">
                    <div class="standings-info-item">
                        <strong>عدد الفرق:</strong>
                        <span>${standings.length}</span>
                    </div>
                    <div class="standings-info-item">
                        <strong>عدد المباريات:</strong>
                        <span>${matches.length}</span>
                    </div>
                    <div class="standings-info-item">
                        <strong>آخر تحديث:</strong>
                        <span>${new Date().toLocaleDateString('ar-EG')}</span>
                    </div>
                </div>
            </div>
            
            <div class="standings-container standings-improved">
                <table class="full-standings-table">
                    <thead>
                        <tr>
                            <th>#</th>
                            <th>الفريق</th>
                            <th>نقاط</th>
                            <th>لعب</th>
                            <th>فوز</th>
                            <th>تعادل</th>
                            <th>خسارة</th>
                            <th>له</th>
                            <th>عليه</th>
                            <th>±</th>
                            <th>انسحابات</th>
                            <th>عقوبات</th>
                        </tr>
                    </thead>
                    <tbody>
        `;
        
        standings.forEach((team, index) => {
            const position = index + 1;
            const isPromotion = position <= 2;
            const isRelegation = position > standings.length - 2;
            const rowClass = isPromotion ? 'promotion' : (isRelegation ? 'relegation' : '');
            
            standingsHTML += `
                <tr class="${rowClass}">
                    <td class="position-cell">${position}</td>
                    <td class="team-name-cell" style="font-weight: 600;">${team.name}</td>
                    <td class="points-cell" style="font-size: 16px; font-weight: bold;">${team.points}</td>
                    <td>${team.played}</td>
                    <td>${team.wins}</td>
                    <td>${team.draws}</td>
                    <td>${team.losses}</td>
                    <td>${team.goalsFor}</td>
                    <td>${team.goalsAgainst}</td>
                    <td style="font-weight: bold; color: ${team.diff > 0 ? '#27ae60' : (team.diff < 0 ? '#e74c3c' : '#333')}">
                        ${team.diff > 0 ? '+' : ''}${team.diff}
                    </td>
                    <td>${team.withdrawals || 0}</td>
                    <td>${team.penalties || 0}</td>
                </tr>
            `;
        });
        
        standingsHTML += `
                    </tbody>
                </table>
            </div>
            
            <div class="standings-info" style="margin-top: 20px;">
                <h4>مفاتيح الجدول</h4>
                <div class="standings-info-grid">
                    <div class="standings-info-item">
                        <div style="width: 15px; height: 15px; background: rgba(46, 204, 113, 0.2); border: 1px solid #27ae60;"></div>
                        <span>مراكز الترقية (المركزان الأولان)</span>
                    </div>
                    <div class="standings-info-item">
                        <div style="width: 15px; height: 15px; background: rgba(231, 76, 60, 0.2); border: 1px solid #e74c3c;"></div>
                        <span>مراكز الهبوط (آخر مركزين)</span>
                    </div>
                    <div class="standings-info-item">
                        <div style="width: 15px; height: 15px; background: #fff; border: 1px solid var(--border);"></div>
                        <span>مراكز متوسطة</span>
                    </div>
                </div>
                <div style="margin-top: 10px; font-size: 13px;">
                    <p><strong>ملاحظة:</strong> ± تعني فارق الأهداف (الأهداف له - الأهداف عليه)</p>
                </div>
            </div>
        `;
        
        return standingsHTML;
    },
    
    // ========== دالة جديدة للحصول على الفرق في المجموعة ==========
    getTeamsInGroup(matches) {
        const teams = new Set();
        matches.forEach(match => {
            if (match["الفريق 1"]) teams.add(match["الفريق 1"]);
            if (match["الفريق 2"]) teams.add(match["الفريق 2"]);
        });
        return Array.from(teams).sort();
    },
    
    // ========== دالة محسنة لإيجاد الفرق الراحلة في كل دورة ==========
    getRestingTeamsForRound(matches, round, allTeams) {
        try {
            // تحويل allTeams إلى Set للتحقق السريع
            const allTeamsSet = new Set(allTeams);
            
            // تحليل المباريات في هذه الدورة
            const playingTeams = new Set();
            
            matches.forEach(match => {
                // التحقق إذا كانت المباراة في الدورة المطلوبة
                const matchRound = parseInt(match.الدورة) || 0;
                if (matchRound === round) {
                    if (match["الفريق 1"] && allTeamsSet.has(match["الفريق 1"])) {
                        playingTeams.add(match["الفريق 1"]);
                    }
                    if (match["الفريق 2"] && allTeamsSet.has(match["الفريق 2"])) {
                        playingTeams.add(match["الفريق 2"]);
                    }
                }
            });
            
            // حساب الفرق الراحلة
            const restingTeams = allTeams.filter(team => !playingTeams.has(team));
            
            return restingTeams;
        } catch (error) {
            console.error('خطأ في حساب الفرق الراحلة:', error);
            return [];
        }
    },
    
    // ========== دالة محسنة لإنشاء جدول الترتيب مع الأعمدة الجديدة ==========
    calculateStandings(matches) {
        const teams = {};
        
        // استخراج جميع الفرق
        matches.forEach(match => {
            if (match["الفريق 1"]) {
                teams[match["الفريق 1"]] = { 
                    name: match["الفريق 1"], 
                    played: 0, 
                    wins: 0, 
                    draws: 0, 
                    losses: 0, 
                    goalsFor: 0, 
                    goalsAgainst: 0, 
                    points: 0,
                    goalDifference: 0,
                    withdrawals: 0, // جديد: عدد مرات الانسحاب
                    penalties: 0    // جديد: عدد مرات العقوبة
                };
            }
            if (match["الفريق 2"]) {
                teams[match["الفريق 2"]] = { 
                    name: match["الفريق 2"], 
                    played: 0, 
                    wins: 0, 
                    draws: 0, 
                    losses: 0, 
                    goalsFor: 0, 
                    goalsAgainst: 0, 
                    points: 0,
                    goalDifference: 0,
                    withdrawals: 0, // جديد: عدد مرات الانسحاب
                    penalties: 0    // جديد: عدد مرات العقوبة
                };
            }
        });
        
        // حساب النتائج والإحصائيات
        matches.forEach(match => {
            const team1 = teams[match["الفريق 1"]];
            const team2 = teams[match["الفريق 2"]];
            
            if (!team1 || !team2) return;
            
            // حالة الانسحاب
            if (match["انسحاب الفريق 1"] === true) {
                team1.played++;
                team1.losses++;
                team1.goalsAgainst += 3;
                team1.withdrawals++; // زيادة عدد مرات الانسحاب
                
                team2.played++;
                team2.wins++;
                team2.points += 3;
                team2.goalsFor += 3;
                return;
            }
            
            if (match["انسحاب الفريق 2"] === true) {
                team2.played++;
                team2.losses++;
                team2.goalsAgainst += 3;
                team2.withdrawals++; // زيادة عدد مرات الانسحاب
                
                team1.played++;
                team1.wins++;
                team1.points += 3;
                team1.goalsFor += 3;
                return;
            }
            
            // حالة المباراة المؤجلة
            if (match.تأجيل === true) {
                return;
            }
            
            // حساب العقوبات
            if (match["عقوبة الفريق 1"] && match["عقوبة الفريق 1"] !== "") {
                team1.penalties++; // زيادة عدد مرات العقوبة
            }
            
            if (match["عقوبة الفريق 2"] && match["عقوبة الفريق 2"] !== "") {
                team2.penalties++; // زيادة عدد مرات العقوبة
            }
            
            // حالة المباراة العادية
            if (match["اهداف 1"] !== undefined && match["اهداف 2"] !== undefined) {
                team1.played++;
                team2.played++;
                
                team1.goalsFor += match["اهداف 1"];
                team1.goalsAgainst += match["اهداف 2"];
                team2.goalsFor += match["اهداف 2"];
                team2.goalsAgainst += match["اهداف 1"];
                
                if (match["اهداف 1"] > match["اهداف 2"]) {
                    team1.wins++;
                    team2.losses++;
                    team1.points += 3;
                } else if (match["اهداف 1"] < match["اهداف 2"]) {
                    team2.wins++;
                    team1.losses++;
                    team2.points += 3;
                } else {
                    team1.draws++;
                    team2.draws++;
                    team1.points += 1;
                    team2.points += 1;
                }
            }
        });
        
        // حساب فارق الأهداف
        Object.values(teams).forEach(team => {
            team.goalDifference = team.goalsFor - team.goalsAgainst;
            team.diff = team.goalDifference;
        });
        
        // تحويل إلى مصفوفة وترتيب
        return Object.values(teams)
            .sort((a, b) => {
                if (b.points !== a.points) return b.points - a.points;
                if (b.diff !== a.diff) return b.diff - a.diff;
                return b.goalsFor - a.goalsFor;
            });
    },
    
    // ========== تحديث دالة عرض آخر دورة على شكل مربعات ==========
    createLastRoundTab(matches, lastRound) {
        // تصفية مباريات آخر دورة المكتملة
        const lastRoundMatches = matches.filter(match => 
            match.الدورة === lastRound && 
            MatchStatusSystem.isPastMatch(match)
        );
        
        if (lastRoundMatches.length === 0) {
            return '<div class="today-matches-empty">لا توجد مباريات مكتملة في آخر دورة</div>';
        }
        
        let html = `
            <div class="previous-rounds-grid">
                <div class="previous-round-box">
                    <div class="previous-round-header">
                        <span>الدورة ${lastRound}</span>
                        <span class="round-number">${lastRoundMatches.length} مباراة</span>
                    </div>
                    <div class="previous-round-matches">
        `;
        
        // ترتيب المباريات حسب الوقت
        const sortedMatches = lastRoundMatches.sort((a, b) => {
            const dateCompare = new Date(a.تاريخ) - new Date(b.تاريخ);
            if (dateCompare !== 0) return dateCompare;
            return (a.الساعة || '').localeCompare(b.الساعة || '');
        });
        
        sortedMatches.forEach(match => {
            const status = MatchStatusSystem.determineMatchStatus(match);
            const badgeClass = MatchStatusSystem.getStatusBadgeClass(status);
            const statusText = MatchStatusSystem.getStatusText(status);
            const result = MatchStatusSystem.getMatchResult(match, status);
            const dateFormatted = Helper.formatArabicDate(match.تاريخ);
            
            // تحديد إذا كانت المباراة مصادق عليها
            const isConfirmed = match["المصادقة"] === true;
            const matchClass = isConfirmed ? 'previous-round-match confirmed-match' : 'previous-round-match';
            
            html += `
                <div class="${matchClass}" 
                     onclick="showMatchDetails(${JSON.stringify(match).replace(/"/g, '&quot;')})">
                    <div class="previous-match-teams">
                        <div style="font-weight: 600;">${match["الفريق 1"] || 'غير معروف'}</div>
                        <div class="previous-match-result">${result}</div>
                        <div style="font-weight: 600;">${match["الفريق 2"] || 'غير معروف'}</div>
                    </div>
                    <div class="previous-match-details">
                        <div class="previous-match-date">
                            <span>${dateFormatted}</span>
                            <span>${match.الساعة || ''}</span>
                        </div>
                        <div>
                            <span class="status-badge ${badgeClass}">
                                ${statusText}
                            </span>
                        </div>
                    </div>
                    <div style="font-size: 11px; color: var(--muted); margin-top: 5px; text-align: center;">
                        ${match.الملعب || 'ملعب غير محدد'}
                    </div>
                </div>
            `;
        });
        
        html += `
                    </div>
                </div>
            </div>
        `;
        
        return html;
    },
    
    // ========== دالة جديدة لعرض المباريات السابقة على شكل مربعات ==========
    createPreviousMatchesTab(matches) {
        // تصفية المباريات التي انتهت (في الماضي)
        const pastMatches = matches.filter(match => 
            MatchStatusSystem.isPastMatch(match)
        );
        
        if (pastMatches.length === 0) {
            return '<div class="today-matches-empty">لا توجد مباريات سابقة منتهية</div>';
        }
        
        // تنظيم المباريات حسب الدورات
        const matchesByRound = {};
        pastMatches.forEach(match => {
            const round = match.الدورة || 0;
            if (!matchesByRound[round]) {
                matchesByRound[round] = [];
            }
            matchesByRound[round].push(match);
        });
        
        // الحصول على قائمة الدورات مرتبة تنازلياً
        const rounds = Object.keys(matchesByRound).sort((a, b) => b - a);
        
        if (rounds.length === 0) {
            return '<div class="today-matches-empty">لا توجد مباريات سابقة منتهية</div>';
        }
        
        let html = `
            <div class="previous-rounds-grid">
        `;
        
        rounds.forEach(round => {
            const roundMatches = matchesByRound[round];
            
            // ترتيب المباريات في الدورة حسب الوقت
            const sortedMatches = roundMatches.sort((a, b) => {
                const dateCompare = new Date(a.تاريخ) - new Date(b.تاريخ);
                if (dateCompare !== 0) return dateCompare;
                return (a.الساعة || '').localeCompare(b.الساعة || '');
            });
            
            html += `
                <div class="previous-round-box">
                    <div class="previous-round-header">
                        <span>الدورة ${round}</span>
                        <span class="round-number">${sortedMatches.length} مباراة</span>
                    </div>
                    <div class="previous-round-matches">
            `;
            
            sortedMatches.forEach(match => {
                const status = MatchStatusSystem.determineMatchStatus(match);
                const badgeClass = MatchStatusSystem.getStatusBadgeClass(status);
                const statusText = MatchStatusSystem.getStatusText(status);
                const result = MatchStatusSystem.getMatchResult(match, status);
                const dateFormatted = Helper.formatArabicDate(match.تاريخ);
                
                // تحديد إذا كانت المباراة مصادق عليها
                const isConfirmed = match["المصادقة"] === true;
                const matchClass = isConfirmed ? 'previous-round-match confirmed-match' : 'previous-round-match';
                
                html += `
                    <div class="${matchClass}" 
                         onclick="showMatchDetails(${JSON.stringify(match).replace(/"/g, '&quot;')})">
                        <div class="previous-match-teams">
                            <div style="font-weight: 600;">${match["الفريق 1"] || 'غير معروف'}</div>
                            <div class="previous-match-result">${result}</div>
                            <div style="font-weight: 600;">${match["الفريق 2"] || 'غير معروف'}</div>
                        </div>
                        <div class="previous-match-details">
                            <div class="previous-match-date">
                                <span>${dateFormatted}</span>
                                <span>${match.الساعة || ''}</span>
                            </div>
                            <div>
                                <span class="status-badge ${badgeClass}">
                                    ${statusText}
                                </span>
                            </div>
                        </div>
                        <div style="font-size: 11px; color: var(--muted); margin-top: 5px; text-align: center;">
                            ${match.الملعب || 'ملعب غير محدد'}
                        </div>
                    </div>
                `;
            });
            
            html += `
                    </div>
                </div>
            `;
        });
        
        html += `
            </div>
            ${this.getColorGuide()}
        `;
        
        return html;
    },
    
    // ========== تعديل دالة إنشاء تبويب المباريات القادمة ==========
    createUpcomingMatchesTab(matches) {
        // البحث عن مباريات محددة التاريخ والوقت في المستقبل (في حدود أسبوعين)
        const matchesWithScheduledDate = matches.filter(match => {
            const status = MatchStatusSystem.determineMatchStatus(match);
            
            // يجب أن تكون المباراة قادمة أو غير محددة
            if (status !== 'upcoming' && status !== 'unknown') {
                return false;
            }
            
            // يجب أن يكون لها تاريخ وساعة
            if (Helper.isDateEmpty(match.تاريخ) || Helper.isTimeEmpty(match.الساعة)) {
                return false;
            }
            
            // يجب أن يكون التاريخ في المستقبل (في حدود أسبوعين)
            return Helper.isDateInFutureWithinTwoWeeks(match.تاريخ);
        });
        
        // إذا وجدت مباريات محددة التاريخ، نعرضها فقط
        if (matchesWithScheduledDate.length > 0) {
            return this.displayScheduledMatches(matchesWithScheduledDate);
        }
        
        // إذا لم توجد مباريات محددة، لا نعرض أي شيء (لا نعرض مباريات الدورة التالية)
        return '<div class="today-matches-empty">لا توجد مباريات قادمة محددة التاريخ</div>';
    },
    
    // ========== دالة لعرض المباريات المحددة التاريخ ==========
    displayScheduledMatches(matches) {
        // ترتيب المباريات حسب التاريخ (الأقرب أولاً)
        const sortedMatches = matches.sort((a, b) => {
            const dateCompare = new Date(a.تاريخ) - new Date(b.تاريخ);
            if (dateCompare !== 0) return dateCompare;
            return (a.الساعة || '').localeCompare(b.الساعة || '');
        });
        
        let html = `
            <div class="previous-rounds-grid">
                <div class="previous-round-box">
                    <div class="previous-round-header">
                        <span>مباريات قادمة محددة التاريخ</span>
                        <span class="round-number">${sortedMatches.length} مباراة</span>
                    </div>
                    <div class="previous-round-matches">
        `;
        
        sortedMatches.forEach(match => {
            const status = MatchStatusSystem.determineMatchStatus(match);
            const badgeClass = MatchStatusSystem.getStatusBadgeClass(status);
            const statusText = MatchStatusSystem.getStatusText(status);
            const dateFormatted = Helper.formatArabicDate(match.تاريخ);
            
            // حساب الأيام المتبقية
            const daysDiff = Helper.getDaysDifference(match.تاريخ);
            let daysText = '';
            if (daysDiff >= 0) {
                daysText = `بعد ${daysDiff} يوم${daysDiff === 1 ? '' : 'ين'}`;
            }
            
            html += `
                <div class="previous-round-match" 
                     onclick="showMatchDetails(${JSON.stringify(match).replace(/"/g, '&quot;')})">
                    <div class="previous-match-teams">
                        <div style="font-weight: 600;">${match["الفريق 1"] || 'غير معروف'}</div>
                        <div class="previous-match-result">VS</div>
                        <div style="font-weight: 600;">${match["الفريق 2"] || 'غير معروف'}</div>
                    </div>
                    <div class="previous-match-details">
                        <div class="previous-match-date">
                            <span>${dateFormatted}</span>
                            <span>${match.الساعة || ''}</span>
                            ${daysDiff >= 0 ? `<span style="color: #27ae60; font-size: 10px; margin-right: 5px;">${daysText}</span>` : ''}
                        </div>
                        <div>
                            <span class="status-badge ${badgeClass}">
                                ${statusText}
                            </span>
                        </div>
                    </div>
                    <div style="font-size: 11px; color: var(--muted); margin-top: 5px; text-align: center;">
                        ${match.الملعب || 'ملعب غير محدد'}
                    </div>
                    <div style="font-size: 10px; color: #7f8c8d; margin-top: 3px; text-align: center;">
                        ${match.القسم || ''} - المجموعة ${match.المجموعة || ''} - الدورة ${match.الدورة || ''}
                    </div>
                </div>
            `;
        });
        
        html += `
                </div>
            </div>
        </div>
        `;
        
        return html;
    },
    
    // ========== تعديل دالة إنشاء برنامج الدورات لعرض الفرق الراحلة ==========
    createProgramTab(matches, allTeams) {
        // تنظيم المباريات حسب الدورات
        const matchesByRound = this.organizeMatchesByRound(matches);
        const rounds = Object.keys(matchesByRound).sort((a, b) => a - b);
        
        if (rounds.length === 0) {
            return '<div class="today-matches-empty">لا يوجد برنامج دورات</div>';
        }
        
        let html = `
            <div class="program-rounds-grid">
        `;
        
        rounds.forEach(round => {
            const roundInt = parseInt(round);
            const roundMatches = matchesByRound[round];
            
            // الحصول على الفرق الراحلة في هذه الدورة
            const restingTeams = this.getRestingTeamsForRound(matches, roundInt, allTeams);
            
            // ترتيب المباريات حسب الوقت
            const sortedMatches = roundMatches.sort((a, b) => {
                const dateCompare = new Date(a.تاريخ) - new Date(b.تاريخ);
                if (dateCompare !== 0) return dateCompare;
                return (a.الساعة || '').localeCompare(b.الساعة || '');
            });
            
            html += `
                <div class="program-round-item">
                    <div class="program-round-header">
                        الدورة ${round}
                        <span style="font-size: 12px; opacity: 0.9;">${roundMatches.length} مباراة</span>
                    </div>
                    <div class="program-round-matches">
            `;
            
            sortedMatches.forEach(match => {
                const status = MatchStatusSystem.determineMatchStatus(match);
                const badgeClass = MatchStatusSystem.getStatusBadgeClass(status);
                const statusText = MatchStatusSystem.getStatusText(status);
                const result = MatchStatusSystem.getMatchResult(match, status);
                const dateFormatted = Helper.formatArabicDate(match.تاريخ);
                
                // تحديد إذا كانت المباراة مصادق عليها
                const isConfirmed = match["المصادقة"] === true;
                const matchClass = isConfirmed ? 'previous-round-match confirmed-match' : 'previous-round-match';
                
                html += `
                    <div class="${matchClass}" 
                         onclick="showMatchDetails(${JSON.stringify(match).replace(/"/g, '&quot;')})">
                        <div class="previous-match-teams">
                            <div style="font-weight: 600;">${match["الفريق 1"] || 'غير معروف'}</div>
                            <div class="previous-match-result">${result}</div>
                            <div style="font-weight: 600;">${match["الفريق 2"] || 'غير معروف'}</div>
                        </div>
                        <div class="previous-match-details">
                            <div class="previous-match-date">
                                <span>${dateFormatted}</span>
                                <span>${match.الساعة || ''}</span>
                            </div>
                            <div>
                                <span class="status-badge ${badgeClass}">
                                    ${statusText}
                                </span>
                            </div>
                        </div>
                        <div style="font-size: 11px; color: var(--muted); margin-top: 5px; text-align: center;">
                            ${match.الملعب || 'ملعب غير محدد'}
                        </div>
                    </div>
                `;
            });
            
            // ========== إضافة قسم الفرق الراحلة ==========
            if (restingTeams.length > 0) {
                html += `
                    <div class="program-resting-teams">
                        <h4>الفرق في حالة راحة</h4>
                        <div class="resting-teams-list">
                `;
                
                restingTeams.forEach(team => {
                    html += `<div class="resting-team-item">${team}</div>`;
                });
                
                html += `
                        </div>
                    </div>
                `;
            }
            
            html += `
                    </div>
                </div>
            `;
        });
        
        html += `
            </div>
            ${this.getColorGuide()}
        `;
        
        return html;
    },
    
    // ========== دالة لإنشاء دليل الألوان للبادجات فقط ==========
    getColorGuide() {
        return `
            <div class="color-guide">
                <h4>دليل ألوان حالة المباريات (للشارات فقط):</h4>
                <div class="color-guide-grid">
                    <div class="color-guide-item">
                        <div class="color-box" style="background: linear-gradient(135deg, #3498db, #2980b9);"></div>
                        <span>قادمة (محددة الموعد)</span>
                    </div>
                    <div class="color-guide-item">
                        <div class="color-box" style="background: linear-gradient(135deg, #95a5a6, #7f8c8d);"></div>
                        <span>لم يحدد موعدها بعد</span>
                    </div>
                    <div class="color-guide-item">
                        <div class="color-box" style="background: linear-gradient(135deg, #e74c3c, #c0392b);"></div>
                        <span>مباشرة</span>
                    </div>
                    <div class="color-guide-item">
                        <div class="color-box" style="background: linear-gradient(135deg, #27ae60, #229954);"></div>
                        <span>مصادق عليها</span>
                    </div>
                    <div class="color-guide-item">
                        <div class="color-box" style="background: linear-gradient(135deg, #f39c12, #e67e22);"></div>
                        <span>مؤجلة</span>
                    </div>
                    <div class="color-guide-item">
                        <div class="color-box" style="background: linear-gradient(135deg, #8e44ad, #732d91);"></div>
                        <span>انسحاب</span>
                    </div>
                    <div class="color-guide-item">
                        <div class="color-box" style="background: linear-gradient(135deg, #2c3e50, #34495e);"></div>
                        <span>متوقفة</span>
                    </div>
                </div>
                <div style="margin-top: 10px; font-size: 11px; color: var(--muted);">
                    <strong>ملاحظة:</strong> المباريات المصادق عليها تظهر بخلفية خضراء فاتحة فقط
                </div>
            </div>
        `;
    },
    
    organizeMatchesByRound(matches) {
        const matchesByRound = {};
        matches.forEach(match => {
            const round = match.الدورة || 0;
            if (!matchesByRound[round]) {
                matchesByRound[round] = [];
            }
            matchesByRound[round].push(match);
        });
        return matchesByRound;
    },
    
    attachGroupTabListeners() {
        document.querySelectorAll('.group-tab').forEach(tab => {
            tab.addEventListener('click', function() {
                const tabName = this.getAttribute('data-tab');
                
                // إزالة النشط من جميع التبويبات
                document.querySelectorAll('.group-tab').forEach(t => t.classList.remove('active'));
                document.querySelectorAll('.group-tab-content').forEach(c => c.classList.remove('active'));
                
                // إضافة النشط للتبويب المحدد
                this.classList.add('active');
                document.getElementById(`${tabName}-tab`).classList.add('active');
            });
        });
    },
    
    backToDivisions() {
        document.getElementById('groupInfoContainer').classList.remove('active');
        document.getElementById('groupInfoContainer').innerHTML = '';
        document.getElementById('divisionsContainer').style.display = 'block';
    },
    
    // تحديث البيانات تلقائياً
    async refreshData() {
        await this.initialize();
    }
};

// ========== دوال جديدة لعرض الجدول الكامل ==========
function showFullStandings() {
    if (!window.currentStandingsData) return;
    
    const { section, group } = window.currentStandingsData;
    
    // تحديث العنوان
    document.getElementById('standingsTitle').textContent = `جدول الترتيب - ${section} - المجموعة ${group}`;
    
    // إنشاء المحتوى
    const content = DynamicDivisionsManager.createFullStandingsContent();
    document.getElementById('standingsContent').innerHTML = content;
    
    // إظهار النافذة
    document.getElementById('standingsOverlay').classList.add('active');
    document.body.style.overflow = 'hidden';
}

function closeFullStandings() {
    document.getElementById('standingsOverlay').classList.remove('active');
    document.body.style.overflow = 'auto';
}

// ========== عرض تفاصيل المباراة ==========
function showMatchDetails(match) {
    if (!match) return;
    
    const status = MatchStatusSystem.determineMatchStatus(match);
    const statusText = MatchStatusSystem.getStatusText(status);
    const headerClass = MatchStatusSystem.getHeaderClass(status);
    const badgeClass = MatchStatusSystem.getStatusBadgeClass(status);
    
    // تحديث عنوان النافذة مع إضافة الحالة
    document.getElementById('matchDetailsTitle').innerHTML = `
        تفاصيل المباراة
        <div style="font-size: 14px; margin-top: 5px; opacity: 0.9;">
            الحالة: <span class="status-badge ${badgeClass}" style="font-size: 12px; padding: 2px 8px;">${statusText}</span>
        </div>
    `;
    
    // تحديث لون الهيدر بناءً على الحالة
    const header = document.getElementById('matchDetailsHeader');
    header.className = 'match-details-header';
    header.classList.add(headerClass);
    
    // إنشاء محتوى تفاصيل المباراة
    let content = '';
    
    // عرض الفريقين والنتيجة
    content += `
        <div class="match-score-display">
            <div class="match-score-teams">
                <div class="match-score-team">
                    <div class="match-score-team-name">${match["الفريق 1"] || ''}</div>
    `;
    
    // عرض النتيجة إذا كانت موجودة
    if (match["اهداف 1"] !== undefined && match["اهداف 2"] !== undefined) {
        content += `
            <div class="match-score-goals">${match["اهداف 1"]}</div>
        `;
    } else if (match.تأجيل === true) {
        content += `
            <div class="match-result-status">مؤجلة</div>
        `;
    } else if (match["انسحاب الفريق 1"] === true) {
        content += `
            <div class="match-result-status">انسحاب</div>
        `;
    } else {
        content += `
            <div class="match-score-goals">-</div>
        `;
    }
    
    content += `
                </div>
                
                <div class="match-score-vs">VS</div>
                
                <div class="match-score-team">
                    <div class="match-score-team-name">${match["الفريق 2"] || ''}</div>
    `;
    
    // عرض النتيجة إذا كانت موجودة
    if (match["اهداف 2"] !== undefined && match["اهداف 1"] !== undefined) {
        content += `
            <div class="match-score-goals">${match["اهداف 2"]}</div>
        `;
    } else if (match["انسحاب الفريق 2"] === true) {
        content += `
            <div class="match-result-status">انسحاب</div>
        `;
    } else {
        content += `
            <div class="match-score-goals">-</div>
        `;
    }
    
    content += `
                </div>
            </div>
            
            <div class="match-result-status">
                ${MatchStatusSystem.getMatchResult(match, status)}
            </div>
        </div>
    `;
    
    // معلومات أساسية
    content += `
        <div class="match-info-grid">
            <div class="match-info-section">
                <h3>المعلومات الأساسية</h3>
                <div class="match-info-item">
                    <span class="match-info-label">القسم:</span>
                    <span class="match-info-value">${match.القسم || ''}</span>
                </div>
                <div class="match-info-item">
                    <span class="match-info-label">المجموعة:</span>
                    <span class="match-info-value">${match.المجموعة || ''}</span>
                </div>
                <div class="match-info-item">
                    <span class="match-info-label">الدورة:</span>
                    <span class="match-info-value">${match.الدورة || ''}</span>
                </div>
                <div class="match-info-item">
                    <span class="match-info-label">التاريخ:</span>
                    <span class="match-info-value">${Helper.formatArabicDate(match.تاريخ)}</span>
                </div>
                <div class="match-info-item">
                    <span class="match-info-label">الساعة:</span>
                    <span class="match-info-value">${match.الساعة || ''}</span>
                </div>
                <div class="match-info-item">
                    <span class="match-info-label">الملعب:</span>
                    <span class="match-info-value">${match.الملعب || ''}</span>
                </div>
            </div>
            
            <div class="match-info-section">
                <h3>طاقم التحكيم</h3>
                <div class="match-info-item">
                    <span class="match-info-label">الحكم:</span>
                    <span class="match-info-value">${match.الحكم || ''}</span>
                </div>
                <div class="match-info-item">
                    <span class="match-info-label">المراقب:</span>
                    <span class="match-info-value">${match.المراقب || ''}</span>
                </div>
            </div>
        </div>
    `;
    
    // معلومات إضافية
    let additionalInfo = '';
    
    if (match["المصادقة"] !== undefined) {
        additionalInfo += `
            <div class="match-info-item">
                <span class="match-info-label">المصادقة:</span>
                <span class="match-info-value">${match["المصادقة"] ? 'نعم' : 'لا'}</span>
            </div>
        `;
    }
    
    if (match["رقم محضر المصادقة"]) {
        additionalInfo += `
            <div class="match-info-item">
                <span class="match-info-label">رقم محضر المصادقة:</span>
                <span class="match-info-value">${match["رقم محضر المصادقة"]}</span>
            </div>
        `;
    }
    
    if (match["قرار لجنة المصادقة"]) {
        additionalInfo += `
            <div class="match-info-item">
                <span class="match-info-label">قرار لجنة المصادقة:</span>
                <span class="match-info-value">${match["قرار لجنة المصادقة"]}</span>
            </div>
        `;
    }
    
    if (match["عقوبة الفريق 1"]) {
        additionalInfo += `
            <div class="match-info-item">
                <span class="match-info-label">عقوبة ${match["الفريق 1"]}:</span>
                <span class="match-info-value">${match["عقوبة الفريق 1"]}</span>
            </div>
        `;
    }
    
    if (match["عقوبة الفريق 2"]) {
        additionalInfo += `
            <div class="match-info-item">
                <span class="match-info-label">عقوبة ${match["الفريق 2"]}:</span>
                <span class="match-info-value">${match["عقوبة الفريق 2"]}</span>
            </div>
        `;
    }
    
    if (match["خصم الأهذاف"]) {
        additionalInfo += `
            <div class="match-info-item">
                <span class="match-info-label">خصم الأهداف:</span>
                <span class="match-info-value">${match["خصم الأهذاف"]}</span>
            </div>
        `;
    }
    
    if (match["خصم النقاط"]) {
        additionalInfo += `
            <div class="match-info-item">
                <span class="match-info-label">خصم النقاط:</span>
                <span class="match-info-value">${match["خصم النقاط"]}</span>
            </div>
        `;
    }
    
    if (additionalInfo) {
        content += `
            <div class="match-info-section">
                <h3>معلومات إضافية</h3>
                ${additionalInfo}
            </div>
        `;
    }
    
    // معلومات الحالة
    content += `
        <div class="match-info-section">
            <h3>معلومات الحالة</h3>
            <div class="match-info-item">
                <span class="match-info-label">حالة المباراة:</span>
                <span class="match-info-value">
                    <span class="status-badge ${badgeClass}">
                        ${statusText}
                    </span>
                </span>
            </div>
        </div>
    `;
    
    // الملاحظات
    if (match.ملاحظات || match["ملاحظات لجنة المصادقة"] || match["رسالة واتساب المراقب"]) {
        let notes = '';
        
        if (match.ملاحظات) {
            notes += `<p><strong>ملاحظات:</strong> ${match.ملاحظات}</p>`;
        }
        
        if (match["ملاحظات لجنة المصادقة"]) {
            notes += `<p><strong>ملاحظات لجنة المصادقة:</strong> ${match["ملاحظات لجنة المصادقة"]}</p>`;
        }
        
        if (match["رسالة واتساب المراقب"]) {
            notes += `<p><strong>رسالة واتساب المراقب:</strong> ${match["رسالة واتساب المراقب"]}</p>`;
        }
        
        content += `
            <div class="match-notes">
                <h4>ملاحظات</h4>
                ${notes}
            </div>
        `;
    }
    
    // الروابط
    if (match["رابط محضر المصادقة"]) {
        content += `
            <div class="match-info-section">
                <h3>الروابط</h3>
                <div class="match-info-item">
                    <span class="match-info-label">رابط محضر المصادقة:</span>
                    <span class="match-info-value">
                        <a href="${match["رابط محضر المصادقة"]}" target="_blank" style="color: var(--accent); text-decoration: underline;">
                            اضغط هنا للعرض
                        </a>
                    </span>
                </div>
            </div>
        `;
    }
    
    // تحديث المحتوى
    document.getElementById('matchDetailsContent').innerHTML = content;
    
    // إظهار النافذة
    document.getElementById('matchDetailsOverlay').classList.add('active');
    document.body.style.overflow = 'hidden';
}

function closeMatchDetails() {
    document.getElementById('matchDetailsOverlay').classList.remove('active');
    document.body.style.overflow = 'auto';
}

// ========== نظام تحميل المباريات للواجهة الرئيسية ==========
async function loadTodayMatches() {
    const container = document.getElementById('todayMatchesContainer');
    container.innerHTML = '<div class="today-matches-loading">جاري تحميل مباريات اليوم...</div>';
    
    try {
        const allMatches = await DynamicDivisionsManager.getAllMatches();
        const today = Helper.getTodayDate();
        
        const todayMatches = allMatches.filter(match => match.تاريخ === today);
        const sortedMatches = todayMatches.sort((a, b) => {
            const dateCompare = new Date(a.تاريخ) - new Date(b.تاريخ);
            if (dateCompare !== 0) return dateCompare;
            
            if (a.الساعة && b.الساعة) {
                return a.الساعة.localeCompare(b.الساعة);
            }
            return 0;
        });
        
        displayMatchesInContainer(sortedMatches, 'todayMatchesContainer', 'لا توجد مباريات اليوم');
        
    } catch (error) {
        console.error('خطأ في تحميل مباريات اليوم:', error);
        container.innerHTML = `
            <div class="today-matches-empty">حدث خطأ في تحميل البيانات</div>
            <button class="refresh-today-btn" onclick="loadTodayMatches()">حاول مرة أخرى</button>
        `;
    }
}

async function loadUpcomingMatches() {
    const container = document.getElementById('upcomingMatchesContainer');
    container.innerHTML = '<div class="today-matches-loading">جاري تحميل المباريات القادمة...</div>';
    
    try {
        const allMatches = await DynamicDivisionsManager.getAllMatches();
        const today = Helper.getTodayDate();
        
        // البحث عن مباريات محددة التاريخ في المستقبل (أسبوعين)
        const matchesWithScheduledDate = allMatches.filter(match => {
            // يجب أن يكون لها تاريخ وساعة
            if (Helper.isDateEmpty(match.تاريخ) || Helper.isTimeEmpty(match.الساعة)) {
                return false;
            }
            
            // يجب أن يكون التاريخ في المستقبل (أسبوعين)
            return Helper.isDateInFutureWithinTwoWeeks(match.تاريخ);
        });
        
        // إذا وجدت مباريات محددة، نعرضها فقط
        if (matchesWithScheduledDate.length > 0) {
            // ترتيب المباريات حسب التاريخ
            const sortedMatches = matchesWithScheduledDate.sort((a, b) => {
                const dateCompare = new Date(a.تاريخ) - new Date(b.تاريخ);
                if (dateCompare !== 0) return dateCompare;
                
                if (a.الساعة && b.الساعة) {
                    return a.الساعة.localeCompare(b.الساعة);
                }
                return 0;
            });
            
            displayMatchesInContainer(sortedMatches, 'upcomingMatchesContainer', 'لا توجد مباريات قادمة');
        } else {
            // إذا لم توجد مباريات محددة، لا نعرض أي شيء
            container.innerHTML = '<div class="today-matches-empty">لا توجد مباريات قادمة محددة التاريخ</div>';
        }
        
    } catch (error) {
        console.error('خطأ في تحميل المباريات القادمة:', error);
        container.innerHTML = `
            <div class="today-matches-empty">حدث خطأ في تحميل البيانات</div>
            <button class="refresh-today-btn" onclick="loadUpcomingMatches()">حاول مرة أخرى</button>
        `;
    }
}

async function loadPreviousMatches() {
    const container = document.getElementById('previousMatchesContainer');
    container.innerHTML = '<div class="today-matches-loading">جاري تحميل المباريات السابقة...</div>';
    
    try {
        const allMatches = await DynamicDivisionsManager.getAllMatches();
        const now = new Date();
        
        // حساب تاريخ قبل أسبوعين
        const twoWeeksAgo = new Date();
        twoWeeksAgo.setDate(now.getDate() - 14);
        
        // تصفية المباريات في آخر أسبوعين
        const previousMatches = allMatches.filter(match => {
            if (!match.تاريخ) return false;
            
            const matchDate = new Date(match.تاريخ);
            return matchDate >= twoWeeksAgo && matchDate < now;
        });
        
        // ترتيب من الأقرب إلى الأبعد (أحدث المباريات أولاً)
        const sortedMatches = previousMatches.sort((a, b) => {
            const dateCompare = new Date(b.تاريخ) - new Date(a.تاريخ);
            if (dateCompare !== 0) return dateCompare;
            
            if (a.الساعة && b.الساعة) {
                return b.الساعة.localeCompare(a.الساعة);
            }
            return 0;
        });
        
        displayMatchesInContainer(sortedMatches, 'previousMatchesContainer', 'لا توجد مباريات سابقة في آخر أسبوعين');
        
    } catch (error) {
        console.error('خطأ في تحميل المباريات السابقة:', error);
        container.innerHTML = `
            <div class="today-matches-empty">حدث خطأ في تحميل البيانات</div>
            <button class="refresh-today-btn" onclick="loadPreviousMatches()">تحديث</button>
        `;
    }
}

function displayMatchesInContainer(matches, containerId, emptyMessage) {
    const container = document.getElementById(containerId);
    
    if (!matches || matches.length === 0) {
        container.innerHTML = `
            <div class="today-matches-empty">${emptyMessage}</div>
        `;
        return;
    }
    
    let matchesHTML = '';
    
    matches.forEach(match => {
        const status = MatchStatusSystem.determineMatchStatus(match);
        const badgeClass = MatchStatusSystem.getStatusBadgeClass(status);
        const statusText = MatchStatusSystem.getStatusText(status);
        const result = MatchStatusSystem.getMatchResult(match, status);
        
        // إنشاء البادج حسب نوع القسم
        let badgeText = '';
        const section = match.القسم || '';
        const group = match.المجموعة || '';
        
        if (section.includes('ممتاز')) {
            badgeText = `ممتاز ${group}`;
        } else if (section.includes('أول')) {
            badgeText = `أول ${group}`;
        } else if (section.includes('ثاني')) {
            badgeText = `ثاني ${group}`;
        } else {
            badgeText = `${section} ${group}`;
        }
        
        const roundBadge = `<span class="round-badge">د${match.الدورة || 0}</span>`;
        const dateFormatted = Helper.formatArabicDate(match.تاريخ);
        
        matchesHTML += `
            <div class="match" onclick="showMatchDetails(${JSON.stringify(match).replace(/"/g, '&quot;')})">
                <div class="badges-container">
                    <span class="match-badge">${badgeText}</span>
                    ${roundBadge}
                    <span class="status-badge ${badgeClass}">
                        ${statusText}
                    </span>
                </div>
                <div class="teams">
                    <div class="team">${match["الفريق 1"] || 'غير معروف'}</div>
                    <div class="match-result">${result}</div>
                    <div class="team">${match["الفريق 2"] || 'غير معروف'}</div>
                </div>
                <div class="match-time-date">
                    <span>${dateFormatted}</span>
                    <span>${match.الساعة || ''}</span>
                </div>
                <div class="stadium">${match.الملعب || 'ملعب غير محدد'}</div>
            </div>
        `;
    });
    
    container.innerHTML = matchesHTML;
}

// ========== نظام الأخبار ==========
let newsArticles = [];
let currentNewsIndex = 0;
let newsAutoplayInterval;
let isAutoplayActive = true;

async function loadNewsFromFirebase() {
    try {
        const newsUrl = `${FIREBASE_BASE_URL}news.json`;
        const data = await Helper.fetchData(newsUrl);
        
        if (data) {
            let newsArray = [];
            
            if (typeof data === 'object' && !Array.isArray(data)) {
                newsArray = Object.values(data)
                    .filter(item => item && item.published !== false);
            } else if (Array.isArray(data)) {
                newsArray = data.filter(item => item && item.published !== false);
            }
            
            newsArray.sort((a, b) => {
                if (a.featured && !b.featured) return -1;
                if (!a.featured && b.featured) return 1;
                
                const dateA = new Date(a.date || a.createdAt || a.timestamp);
                const dateB = new Date(b.date || b.createdAt || b.timestamp);
                return dateB - dateA;
            });
            
            newsArticles = newsArray.map((item, index) => ({
                id: index,
                title: item.title || "بدون عنوان",
                date: formatNewsDate(item.date || item.createdAt),
                image: item.imageUrl || item.image || "default-news.jpg",
                excerpt: item.excerpt || item.content?.substring(0, 150) + "..." || "لا يوجد محتوى",
                fullContent: generateFullArticleContent(item),
                featured: item.featured || false
            }));
            
            if (newsArticles.length === 0) {
                newsArticles = getDefaultNews();
            }
            
            updateNewsSlider();
        } else {
            newsArticles = getDefaultNews();
            updateNewsSlider();
        }
        
    } catch (error) {
        console.error('خطأ في تحميل الأخبار:', error);
        newsArticles = getDefaultNews();
        updateNewsSlider();
    }
}

function formatNewsDate(dateString) {
    try {
        const date = new Date(dateString);
        if (isNaN(date.getTime())) {
            return "تاريخ غير محدد";
        }
        
        const arabicMonths = ['يناير', 'فبراير', 'مارس', 'أبريل', 'مايو', 'يونيو', 
                              'يوليو', 'أغسطس', 'سبتمبر', 'أكتوبر', 'نوفمبر', 'ديسمبر'];
        const arabicDays = ['الأحد', 'الإثنين', 'الثلاثاء', 'الأربعاء', 'الخميس', 'الجمعة', 'السبت'];
        
        const dayName = arabicDays[date.getDay()];
        const day = date.getDate();
        const month = arabicMonths[date.getMonth()];
        const year = date.getFullYear();
        
        return `${dayName}، ${day} ${month} ${year}`;
    } catch (e) {
        return "تاريخ غير محدد";
    }
}

function generateFullArticleContent(newsItem) {
    const title = newsItem.title || "بدون عنوان";
    const date = formatNewsDate(newsItem.date || newsItem.createdAt || new Date().toISOString());
    const image = newsItem.imageUrl || newsItem.image || "default-news.jpg";
    const author = newsItem.author || "محرر الموقع";
    const content = newsItem.content || "لا يوجد محتوى للمقال";
    
    if (newsItem.formattedContent) {
        return newsItem.formattedContent;
    }
    
    let formattedContent = content;
    if (!content.includes('<p>') && !content.includes('<div>')) {
        const paragraphs = content.split('\n').filter(p => p.trim());
        formattedContent = paragraphs.map(p => `<p>${p}</p>`).join('');
    }
    
    return `
        <div class="article-image-container">
            <img src="${image}" alt="${title}" onerror="this.src='default-news.jpg'">
        </div>
        <div class="article-meta">
            <div class="news-date">${date}</div>
            <div>كاتب: ${author}</div>
        </div>
        <div class="article-full-text">
            ${formattedContent}
        </div>
    `;
}

function getDefaultNews() {
    return [
        {
            id: 0,
            title: "انطلاق منافسات القسم الممتاز بموسم جديد",
            date: "15 مارس 2024",
            image: "news1.jpg",
            excerpt: "انطلقت يوم السبت الماضي منافسات القسم الممتاز لكرة القدم بعصبة طنجة تطوان الحسيمة، بمشاركة 16 فريقاً تنقسم إلى مجموعتين...",
            fullContent: `
                <div class="article-image-container">
                    <img src="news1.jpg" alt="انطلاق منافسات القسم الممتاز">
                </div>
                <div class="article-meta">
                    <div class="news-date">15 مارس 2024</div>
                    <div>كاتب: محمد العبد</div>
                </div>
                <div class="article-full-text">
                    <p>انطلقت يوم السبت الماضي منافسات القسم الممتاز لكرة القدم بعصبة طنجة تطوان الحسيمة، بمشاركة 16 فريقاً تنقسم إلى مجموعتين.</p>
                    <p>مرحباً بكم في موقع هواة الشمال. سيتم تحميل الأخبار الحقيقية من قاعدة البيانات قريباً.</p>
                </div>
            `,
            featured: true
        }
    ];
}

function updateNewsSlider() {
    const slider = document.getElementById('newsMainSlider');
    const dotsContainer = document.getElementById('newsDots');
    
    if (!slider || !dotsContainer) return;
    
    currentNewsIndex = 0;
    
    if (newsArticles.length === 0) {
        slider.innerHTML = '<div class="loading-data">لا توجد أخبار متاحة حالياً</div>';
        dotsContainer.innerHTML = '';
        return;
    }
    
    let slidesHTML = '';
    newsArticles.forEach((article, index) => {
        const featuredBadge = article.featured ? '<span class="featured-badge">مميز</span>' : '';
        
        slidesHTML += `
            <div class="news-slide ${index === 0 ? 'active' : ''}" data-index="${index}">
                <div class="news-slide-content">
                    <div class="news-image-container" onclick="openFullArticle(${index})">
                        <img src="${article.image}" alt="${article.title}" onerror="this.src='default-news.jpg'">
                    </div>
                    <h3 class="news-title" onclick="openFullArticle(${index})">
                        ${featuredBadge}${article.title}
                    </h3>
                    <div class="news-excerpt">${article.excerpt}</div>
                    <div class="news-meta">
                        <div class="news-date">
                            <span>${article.date}</span>
                        </div>
                        <div class="news-read-more" onclick="openFullArticle(${index})">
                            قراءة المزيد →
                        </div>
                    </div>
                </div>
            </div>
        `;
    });
    
    slider.innerHTML = slidesHTML;
    
    let dotsHTML = '';
    newsArticles.forEach((_, index) => {
        dotsHTML += `<div class="news-slider-dot ${index === 0 ? 'active' : ''}" data-index="${index}"></div>`;
    });
    
    dotsContainer.innerHTML = dotsHTML;
    
    initializeNewsSlider();
}

function initializeNewsSlider() {
    const prevBtn = document.getElementById('prevNews');
    const nextBtn = document.getElementById('nextNews');
    const toggleBtn = document.getElementById('autoplayToggle');
    
    const newPrevBtn = prevBtn.cloneNode(true);
    const newNextBtn = nextBtn.cloneNode(true);
    const newToggleBtn = toggleBtn.cloneNode(true);
    
    prevBtn.parentNode.replaceChild(newPrevBtn, prevBtn);
    nextBtn.parentNode.replaceChild(newNextBtn, nextBtn);
    toggleBtn.parentNode.replaceChild(newToggleBtn, toggleBtn);
    
    newPrevBtn.addEventListener('click', showPrevNews);
    newNextBtn.addEventListener('click', showNextNews);
    newToggleBtn.addEventListener('click', toggleAutoplay);
    
    document.querySelectorAll('.news-slider-dot').forEach((dot, index) => {
        dot.addEventListener('click', () => showNewsSlide(index));
    });
    
    startAutoplay();
}

function showNewsSlide(index) {
    if (newsArticles.length === 0) return;
    
    currentNewsIndex = index;
    
    document.querySelectorAll('.news-slide').forEach(slide => {
        slide.classList.remove('active');
    });
    
    const targetSlide = document.querySelector(`.news-slide[data-index="${index}"]`);
    if (targetSlide) {
        targetSlide.classList.add('active');
    }
    
    document.querySelectorAll('.news-slider-dot').forEach(dot => {
        dot.classList.remove('active');
    });
    
    const targetDot = document.querySelector(`.news-slider-dot[data-index="${index}"]`);
    if (targetDot) {
        targetDot.classList.add('active');
    }
    
    if (isAutoplayActive) {
        restartAutoplay();
    }
}

function showNextNews() {
    if (newsArticles.length === 0) return;
    
    let nextIndex = currentNewsIndex + 1;
    if (nextIndex >= newsArticles.length) {
        nextIndex = 0;
    }
    showNewsSlide(nextIndex);
}

function showPrevNews() {
    if (newsArticles.length === 0) return;
    
    let prevIndex = currentNewsIndex - 1;
    if (prevIndex < 0) {
        prevIndex = newsArticles.length - 1;
    }
    showNewsSlide(prevIndex);
}

function startAutoplay() {
    if (isAutoplayActive && newsArticles.length > 1) {
        stopAutoplay();
        newsAutoplayInterval = setInterval(showNextNews, 5000);
    }
}

function stopAutoplay() {
    clearInterval(newsAutoplayInterval);
}

function restartAutoplay() {
    stopAutoplay();
    startAutoplay();
}

function toggleAutoplay() {
    const toggleBtn = document.getElementById('autoplayToggle');
    isAutoplayActive = !isAutoplayActive;
    
    if (isAutoplayActive) {
        toggleBtn.classList.add('active');
        startAutoplay();
    } else {
        toggleBtn.classList.remove('active');
        stopAutoplay();
    }
}

function openFullArticle(articleIndex) {
    if (articleIndex < 0 || articleIndex >= newsArticles.length) return;
    
    const article = newsArticles[articleIndex];
    
    document.getElementById('articleTitle').textContent = article.title;
    document.getElementById('articleContent').innerHTML = article.fullContent;
    document.getElementById('articleOverlay').classList.add('active');
    
    stopAutoplay();
    document.body.style.overflow = 'hidden';
}

function closeFullArticle() {
    document.getElementById('articleOverlay').classList.remove('active');
    
    if (isAutoplayActive) {
        startAutoplay();
    }
    
    document.body.style.overflow = 'auto';
}

// ========== نظام الإعلانات ==========
async function loadAds() {
    try {
        const response = await fetch(`${FIREBASE_BASE_URL}ads.json`);
        const data = await response.json();
        
        const adSpace = document.getElementById('adSpace');
        
        if (!data || Object.keys(data).length === 0) {
            adSpace.innerHTML = `<img src="howatchamal.png" alt="إعلان">`;
            return;
        }
        
        let adsArray = [];
        if (typeof data === 'object') {
            adsArray = Object.values(data)
                .filter(ad => ad && ad.active === true)
                .sort((a, b) => (b.timestamp || 0) - (a.timestamp || 0));
        }
        
        if (adsArray.length === 0) {
            adSpace.innerHTML = `<img src="howatchamal.png" alt="إعلان">`;
            return;
        }
        
        const latestAd = adsArray[0];
        
        if (latestAd.link) {
            adSpace.innerHTML = `
                <a href="${latestAd.link}" target="_blank" rel="noopener noreferrer">
                    <img src="${latestAd.imageUrl}" alt="${latestAd.title}">
                    <div class="ad-title">${latestAd.title}</div>
                </a>
            `;
        } else {
            adSpace.innerHTML = `
                <img src="${latestAd.imageUrl}" alt="${latestAd.title}">
                <div class="ad-title">${latestAd.title}</div>
            `;
        }
        
    } catch (error) {
        console.error('خطأ في تحميل الإعلانات:', error);
        const adSpace = document.getElementById('adSpace');
        adSpace.innerHTML = `<img src="howatchamal.png" alt="إعلان">`;
    }
}

// ========== عداد الزيارات ==========
async function updateVisitCounter() {
    try {
        const response = await fetch(VISIT_COUNTER_URL);
        let currentCount = 0;
        
        if (response.ok) {
            const data = await response.json();
            currentCount = data || 0;
        }
        
        const newCount = currentCount + 1;
        
        await fetch(VISIT_COUNTER_URL, {
            method: "PUT",
            headers: { "Content-Type": "application/json" },
            body: JSON.stringify(newCount)
        });
        
        displayVisitCounter(newCount);
    } catch (error) {
        console.log('خطأ في تحديث عداد الزيارات:', error);
    }
}

function displayVisitCounter(count) {
    let counterElement = document.getElementById('visitCounter');
    
    if (!counterElement) {
        counterElement = document.createElement('div');
        counterElement.id = 'visitCounter';
        counterElement.style.cssText = `
            position: fixed;
            bottom: 15px;
            left: 15px;
            background: #0b5d3b;
            color: white;
            padding: 10px 15px;
            border-radius: 20px;
            font-family: 'Cairo', sans-serif;
            font-size: 14px;
            z-index: 1000;
            box-shadow: 0 4px 12px rgba(0,0,0,0.2);
            direction: ltr;
            text-align: center;
        `;
        document.body.appendChild(counterElement);
    }
    
    counterElement.innerHTML = `عدد الزيارات: <strong>${count}</strong>`;
}

// ========== تهيئة النظام ==========
document.addEventListener('DOMContentLoaded', function() {
    // التنقل بين تبويبات المباريات
    const matchNavButtons = document.querySelectorAll('.matches-nav-btn');
    const matchTabs = document.querySelectorAll('.matches-tab');
    
    matchNavButtons.forEach(button => {
        button.addEventListener('click', function() {
            const targetTab = this.getAttribute('data-tab');
            
            matchNavButtons.forEach(btn => btn.classList.remove('active'));
            this.classList.add('active');
            
            matchTabs.forEach(tab => tab.classList.remove('active'));
            
            document.getElementById(`${targetTab}MatchesTab`).classList.add('active');
            
            if (targetTab === 'today') {
                loadTodayMatches();
            } else if (targetTab === 'upcoming') {
                loadUpcomingMatches();
            } else if (targetTab === 'previous') {
                loadPreviousMatches();
            }
        });
    });

    // تحديث التاريخ والوقت
    updateDateTimeArabic();
    updateDateTimeFrench();
    setInterval(updateDateTimeArabic, 1000);
    setInterval(updateDateTimeFrench, 1000);
    
    // تحميل الأقسام والمجموعات من قاعدة البيانات
    DynamicDivisionsManager.initialize();
    
    // تحميل الأخبار
    loadNewsFromFirebase();
    
    // تشغيل المهام بعد تأخير
    setTimeout(loadTodayMatches, 100);
    setTimeout(updateVisitCounter, 1000);
    setTimeout(loadAds, 1000);
    
    // تحديث الأقسام تلقائياً كل 5 دقائق
    setInterval(() => {
        DynamicDivisionsManager.refreshData();
    }, 5 * 60 * 1000);
    
    // تحديث الأخبار تلقائياً
    setInterval(() => {
        loadNewsFromFirebase();
    }, 5 * 60 * 1000);
    
    // تحديث الإعلانات تلقائياً
    setInterval(() => {
        loadAds();
    }, 60 * 1000);
    
    // إغلاق نوافذ التفاصيل عند الضغط على Escape
    document.addEventListener('keydown', function(e) {
        if (e.key === 'Escape') {
            if (document.getElementById('articleOverlay').classList.contains('active')) {
                closeFullArticle();
            }
            if (document.getElementById('matchDetailsOverlay').classList.contains('active')) {
                closeMatchDetails();
            }
            if (document.getElementById('standingsOverlay').classList.contains('active')) {
                closeFullStandings();
            }
        }
    });
    
    // إغلاق نوافذ التفاصيل عند النقر خارجها
    document.getElementById('articleOverlay').addEventListener('click', function(e) {
        if (e.target === this) {
            closeFullArticle();
        }
    });
    
    document.getElementById('matchDetailsOverlay').addEventListener('click', function(e) {
        if (e.target === this) {
            closeMatchDetails();
        }
    });
    
    document.getElementById('standingsOverlay').addEventListener('click', function(e) {
        if (e.target === this) {
            closeFullStandings();
        }
    });
    
    // تحديث المباريات الحية تلقائياً كل 30 ثانية
    setInterval(() => {
        const activeTab = document.querySelector('.matches-tab.active');
        if (activeTab && activeTab.id === 'todayMatchesTab') {
            loadTodayMatches();
        }
    }, 30000);
});

// ========== نظام التاريخ والوقت ==========
function updateDateTimeArabic() {
    const now = new Date();
    const weekdays = ['الأحد', 'الإثنين', 'الثلاثاء', 'الأربعاء', 'الخميس', 'الجمعة', 'السبت'];
    const months = ['يناير', 'فبراير', 'مارس', 'أبريل', 'مايو', 'يونيو', 'يوليو', 'أغسطس', 'سبتمبر', 'أكتوبر', 'نوفمبر', 'ديسمبر'];
    
    const weekday = weekdays[now.getDay()];
    const day = now.getDate();
    const month = months[now.getMonth()];
    const year = now.getFullYear();
    
    const hours = now.getHours().toString().padStart(2, '0');
    const minutes = now.getMinutes().toString().padStart(2, '0');
    const seconds = now.getSeconds().toString().padStart(2, '0');
    
    const dateTimeStr = `${weekday}، ${day} ${month} ${year} - ${hours}:${minutes}:${seconds}`;
    document.getElementById('currentDateTimeArabic').textContent = dateTimeStr;
}

function updateDateTimeFrench() {
    const now = new Date();
    const options = { 
        weekday: 'long', 
        year: 'numeric', 
        month: 'long', 
        day: 'numeric',
        hour: '2-digit',
        minute: '2-digit',
        second: '2-digit'
    };
    const dateTimeStr = now.toLocaleDateString('fr-FR', options);
    document.getElementById('currentDateTimeFrench').textContent = dateTimeStr;
}
</script>
</body>
</html>
